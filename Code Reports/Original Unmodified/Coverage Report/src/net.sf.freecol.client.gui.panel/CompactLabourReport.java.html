<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>CompactLabourReport.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">src (May 7, 2016 6:04:12 PM)</a> &gt; <a href="../../index.html" class="el_group">FreeCol</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.source.html" class="el_package">net.sf.freecol.client.gui.panel</a> &gt; <span class="el_source">CompactLabourReport.java</span></div><h1>CompactLabourReport.java</h1><pre class="source lang-java linenums">/**
 *  Copyright (C) 2002-2016   The FreeCol Team
 *
 *  This file is part of FreeCol.
 *
 *  FreeCol is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  FreeCol is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with FreeCol.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */

package net.sf.freecol.client.gui.panel;

import java.awt.Color;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

import java.util.Collections;
import java.util.Set;
import java.util.stream.Collectors;

import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.SwingConstants;
import javax.swing.border.Border;
import javax.swing.border.EmptyBorder;

import net.miginfocom.swing.MigLayout;

import net.sf.freecol.client.FreeColClient;
import net.sf.freecol.client.gui.ImageLibrary;
import net.sf.freecol.common.i18n.Messages;
import net.sf.freecol.common.model.Ability;
import net.sf.freecol.common.model.Colony;
import net.sf.freecol.common.model.GoodsType;
import net.sf.freecol.common.model.StringTemplate;
import net.sf.freecol.common.model.Unit;
import net.sf.freecol.common.model.UnitType;
import net.sf.freecol.common.model.WorkLocation;
import static net.sf.freecol.common.util.CollectionUtils.*;


/**
 * This panel displays the Labour Report.
 */
public final class CompactLabourReport extends ReportPanel {

<span class="nc" id="L59">    private final int COLONY_COLUMN = 0;</span>
<span class="nc" id="L60">    private final int UNIT_TYPE_COLUMN = 1;</span>
<span class="nc" id="L61">    private final int WORKING_COLUMN = 2;</span>
<span class="nc" id="L62">    private final int BUILDING_COLUMN = 3;</span>
<span class="nc" id="L63">    private final int COLONIST_COLUMN = 4;</span>
<span class="nc" id="L64">    private final int COLONIST_SUMMARY_COLUMN = 5;</span>
<span class="nc" id="L65">    private final int PRODUCTION_SYMBOL_COLUMN = 6;</span>
<span class="nc" id="L66">    private final int PRODUCTION_COLUMN = 7;</span>
<span class="nc" id="L67">    private final int PRODUCTION_SUMMARY_COLUMN = 8;</span>
<span class="nc" id="L68">    private final int NETPRODUCTION_SUMMARY_COLUMN = 9;</span>

    private static final int COLUMNS = 10;

    private LabourData labourData;

    private final LabourData.UnitData unitData;

    private boolean showProduction;
    private boolean showNetProduction;
    private boolean showProductionSymbols;

    private boolean showBuildings;

<span class="nc" id="L82">    private final JPanel headerRow = new MigPanel(&quot;ReportPanelUI&quot;);</span>


    /**
     * The constructor that will add the items to this panel.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     */
    public CompactLabourReport(FreeColClient freeColClient) {
<span class="nc" id="L91">        this(freeColClient, null);</span>

<span class="nc" id="L93">        labourData = new LabourData(getFreeColClient());</span>
<span class="nc" id="L94">    }</span>

    /**
     * The constructor that will add the items to this panel.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @param data The &lt;code&gt;UnitData&lt;/code&gt; to display in this report.
     */
    public CompactLabourReport(FreeColClient freeColClient,
                               LabourData.UnitData data) {
<span class="nc bnc" id="L104" title="All 2 branches missed.">        super(freeColClient, ((data == null) ? &quot;reportLabourAction&quot;</span>
<span class="nc" id="L105">                : &quot;report.labour.details&quot;));</span>

<span class="nc" id="L107">        this.unitData = data;</span>

<span class="nc" id="L109">        headerRow.setBorder(new EmptyBorder(20, 20, 0, 20));</span>
<span class="nc" id="L110">        headerRow.setOpaque(true);</span>
<span class="nc" id="L111">        scrollPane.setColumnHeaderView(headerRow);</span>
<span class="nc" id="L112">    }</span>


    @Override
    public JButton createColonyButton(final Colony colony) {
<span class="nc" id="L117">        String text = colony.getName();</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">        if (!unitData.isSummary()) {</span>
            /*
            int unitIndex = unitData.getUnitType().getIndex();
            
            int skillLevel = Unit.getSkillLevel(unitIndex);
            if (skillLevel &lt;= 0 &amp;&amp; skillLevel &gt; -2) {
            //settlers and servants can be trained anywwhere a farmer can
            unitIndex = Unit.EXPERT_FARMER;
            }
            */

<span class="nc bnc" id="L129" title="All 2 branches missed.">            if (colony.canTrain(unitData.getUnitType())) {</span>
<span class="nc" id="L130">                text = text + &quot;*&quot;;</span>
            }
        }

<span class="nc" id="L134">        return createButton(text, (ActionEvent ae) -&gt; {</span>
<span class="nc" id="L135">                getGUI().showColonyPanel(colony, null);</span>
<span class="nc" id="L136">        });</span>
    }


    @Override
    public void initialize() {
<span class="nc bnc" id="L142" title="All 2 branches missed.">        if (isOverview()) {</span>
<span class="nc" id="L143">            showProduction = true;</span>
<span class="nc" id="L144">            showNetProduction = true;</span>
<span class="nc" id="L145">            showProductionSymbols = true;</span>
<span class="nc" id="L146">            showBuildings = false;</span>
<span class="nc" id="L147">        } else {</span>
<span class="nc" id="L148">            showProduction = unitData.showProduction();</span>
<span class="nc" id="L149">            showNetProduction = unitData.showNetProduction();</span>
<span class="nc" id="L150">            showProductionSymbols = false;</span>

<span class="nc" id="L152">            GoodsType expertProduction = getGoodsType();</span>
<span class="nc bnc" id="L153" title="All 6 branches missed.">            showBuildings = (expertProduction != null &amp;&amp; !expertProduction.isFarmed()) || unitData.getTotal().isTraining();</span>
        }


<span class="nc" id="L157">        String layoutConstraints = &quot;fill, insets 0, gap 0 0&quot;;</span>
<span class="nc" id="L158">        StringBuilder widths = new StringBuilder();</span>
<span class="nc" id="L159">        widths.append(&quot;[175, fill]&quot;);</span>
<span class="nc bnc" id="L160" title="All 4 branches missed.">        widths.append(isOverview() || !unitData.isSummary() ? &quot;[150, fill]&quot; : &quot;[0!]&quot;);</span>
<span class="nc" id="L161">        widths.append(&quot;[150, fill]&quot;);</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">        widths.append(showBuildings ? &quot;[130, fill]&quot; : &quot;[0!]&quot;);</span>
<span class="nc" id="L163">        widths.append(&quot;[26, fill][33, fill]&quot;);</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">        widths.append(showProductionSymbols ? &quot;[50, fill]&quot; : &quot;[0!]&quot;);</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">        widths.append(showProduction ? &quot;[30, fill][40, fill]&quot; : &quot;[0!][0!]&quot;);</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">        widths.append(showNetProduction ? &quot;[40, fill]&quot; : &quot;[0!]&quot;);</span>
<span class="nc" id="L167">        String columnConstraints = widths.toString();</span>
<span class="nc" id="L168">        String rowConstraints = &quot;[fill]&quot;;</span>

<span class="nc" id="L170">        headerRow.setLayout(new MigLayout(layoutConstraints, columnConstraints, rowConstraints));</span>
<span class="nc" id="L171">        reportPanel.setLayout(new MigLayout(layoutConstraints, columnConstraints, rowConstraints));</span>

<span class="nc" id="L173">        addHeader();</span>

<span class="nc bnc" id="L175" title="All 2 branches missed.">        if (isOverview()) {</span>
<span class="nc" id="L176">            addUnitTypes();</span>
<span class="nc" id="L177">        } else {</span>
<span class="nc" id="L178">            addLocations();</span>
        }
<span class="nc" id="L180">    }</span>

    protected Border createBorder() {
<span class="nc" id="L183">        return new EmptyBorder(0, 20, 20, 20);</span>
    }

    /**
     * adds the header rows
     */
    private void addHeader() {

<span class="nc" id="L191">        JLabel empty = new JLabel();</span>
<span class="nc" id="L192">        empty.setBorder(Utility.TOPLEFTCELLBORDER);</span>
<span class="nc" id="L193">        headerRow.add(empty, &quot;cell &quot; + COLONY_COLUMN + &quot; 1&quot;);</span>

<span class="nc bnc" id="L195" title="All 4 branches missed.">        if (isOverview() || !unitData.isSummary()) {</span>
<span class="nc" id="L196">            JLabel unitType = Utility.localizedLabel(&quot;unitType&quot;);</span>
<span class="nc" id="L197">            unitType.setBorder(Utility.TOPCELLBORDER);</span>
<span class="nc" id="L198">            headerRow.add(unitType, &quot;cell &quot; + UNIT_TYPE_COLUMN + &quot; 1&quot;);</span>
        }

<span class="nc" id="L201">        JLabel workingAs = Utility.localizedLabel(&quot;report.labour.workingAs&quot;);</span>
<span class="nc" id="L202">        workingAs.setBorder(Utility.TOPCELLBORDER);</span>
<span class="nc" id="L203">        headerRow.add(workingAs, &quot;cell &quot; + WORKING_COLUMN + &quot; 1&quot;);</span>

<span class="nc bnc" id="L205" title="All 2 branches missed.">        if (showBuildings) {</span>
<span class="nc" id="L206">            JLabel building = Utility.localizedLabel(&quot;building&quot;);</span>
<span class="nc" id="L207">            building.setBorder(Utility.TOPCELLBORDER);</span>
<span class="nc" id="L208">            headerRow.add(building, &quot;cell &quot; + BUILDING_COLUMN + &quot; 1&quot;);</span>
        }

<span class="nc" id="L211">        JLabel colonists = Utility.localizedLabel(&quot;colonists&quot;);</span>
<span class="nc" id="L212">        colonists.setBorder(Utility.TOPCELLBORDER);</span>
<span class="nc" id="L213">        headerRow.add(colonists, &quot;cell &quot; + COLONIST_COLUMN + &quot; 1 2 1&quot;);</span>

<span class="nc bnc" id="L215" title="All 2 branches missed.">        if (isOverview()) {</span>
<span class="nc" id="L216">            JLabel production = Utility.localizedLabel(&quot;report.labour.production&quot;);</span>
<span class="nc" id="L217">            production.setBorder(Utility.TOPCELLBORDER);</span>
<span class="nc" id="L218">            headerRow.add(production, &quot;cell &quot; + PRODUCTION_SYMBOL_COLUMN + &quot; 1 &quot; + (COLUMNS - PRODUCTION_SYMBOL_COLUMN) + &quot; 1&quot;);</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">        } else if (showProduction) {</span>
<span class="nc" id="L220">            LabourData.UnitData unit = unitData;</span>
<span class="nc" id="L221">            GoodsType goods = unit.getExpertProduction();</span>

<span class="nc" id="L223">            ImageLibrary lib = getImageLibrary();</span>
<span class="nc" id="L224">            JLabel production = new JLabel(new ImageIcon(lib.getIconImage(goods)));</span>
<span class="nc" id="L225">            production.setBorder(Utility.TOPCELLBORDER);</span>

<span class="nc bnc" id="L227" title="All 4 branches missed.">            headerRow.add(production, &quot;cell &quot; + PRODUCTION_SYMBOL_COLUMN + &quot; 1 &quot; + (COLUMNS - PRODUCTION_SYMBOL_COLUMN + (showNetProduction &amp;&amp; goods.isStoredAs() ? 1 : 0)) + &quot; 1&quot;);</span>

<span class="nc bnc" id="L229" title="All 4 branches missed.">            if (showNetProduction &amp;&amp; goods.isStoredAs()) {</span>
<span class="nc" id="L230">                JLabel netProduction = new JLabel(new ImageIcon(lib.getIconImage(goods.getStoredAs())));</span>
<span class="nc" id="L231">                netProduction.setBorder(Utility.TOPCELLBORDER);</span>
<span class="nc" id="L232">                headerRow.add(netProduction, &quot;cell &quot; + NETPRODUCTION_SUMMARY_COLUMN + &quot; 1&quot;);</span>
            }
        }

<span class="nc bnc" id="L236" title="All 2 branches missed.">        if (!isSummary()) {</span>
<span class="nc" id="L237">            ImageIcon icon = new ImageIcon(</span>
<span class="nc" id="L238">                getImageLibrary().getUnitImage(unitData.getUnitType()));</span>
<span class="nc" id="L239">            header.setIcon(icon);</span>
<span class="nc" id="L240">            header.setIconTextGap(20);</span>
        }
<span class="nc" id="L242">    }</span>

    /**
     * Add unit data for a given location.
     *
     * @param data The &lt;code&gt;LocationData&lt;/code&gt; to add to.
     * @param colony The enclosing &lt;code&gt;Colony&lt;/code&gt;.
     * @param row The starting row.
     * @return The finishing row.
     */
    private int addLocationData(LabourData.LocationData data, Colony colony,
                                int row) {
<span class="nc" id="L254">        boolean allColonists = data.getUnitData().isSummary();</span>

<span class="nc" id="L256">        LabourData.UnitData unit = data.getUnitData();</span>
<span class="nc" id="L257">        UnitType unitType = unit.getUnitType();</span>
<span class="nc" id="L258">        String unitName = unit.getUnitName();</span>

<span class="nc" id="L260">        String workingAs = null;</span>
<span class="nc" id="L261">        WorkLocation productionWL = null;</span>

<span class="nc bnc" id="L263" title="All 2 branches missed.">        if (!allColonists) {</span>
<span class="nc" id="L264">            workingAs = Messages.message(unitType.getWorkingAsKey());</span>
<span class="nc bnc" id="L265" title="All 2 branches missed.">            if (colony != null) {</span>
<span class="nc" id="L266">                GoodsType expert = unitType.getExpertProduction();</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">                if (expert != null) {</span>
<span class="nc" id="L268">                    productionWL = colony.getWorkLocationForProducing(expert);</span>
                }
            }
        }
<span class="nc" id="L272">        addLocationSummary(data, row);</span>

<span class="nc" id="L274">        int buildingStartRow = row;</span>

        //details
<span class="nc" id="L277">        int otherAmateurs = data.getOtherWorkingAmateurs().getColonists();</span>
<span class="nc bnc" id="L278" title="All 4 branches missed.">        if (!allColonists &amp;&amp; otherAmateurs &gt; 0) {</span>
<span class="nc" id="L279">            addRow(data,</span>
<span class="nc" id="L280">                   Messages.message(&quot;report.labour.otherUnitType&quot;),</span>
<span class="nc" id="L281">                   workingAs,</span>
<span class="nc" id="L282">                   createNonCountedLabel(otherAmateurs),</span>
<span class="nc" id="L283">                   data.getOtherWorkingAmateurs().getProduction(),</span>
<span class="nc" id="L284">                   row);</span>
<span class="nc" id="L285">            row++;</span>
        }

<span class="nc" id="L288">        row = addRow(data,</span>
<span class="nc" id="L289">                     unitName,</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">                     allColonists ? Messages.message(&quot;report.labour.expertsWorking&quot;) : workingAs,</span>
<span class="nc" id="L291">                     data.getWorkingProfessionals().getColonists(),</span>
<span class="nc" id="L292">                     data.getWorkingProfessionals().getProduction(),</span>
<span class="nc" id="L293">                     row);</span>

<span class="nc" id="L295">        int notProducingStartRow = row;</span>

<span class="nc bnc" id="L297" title="All 2 branches missed.">        if (showBuildings) {</span>
<span class="nc bnc" id="L298" title="All 4 branches missed.">            if (productionWL != null &amp;&amp; row &gt; buildingStartRow) {</span>
<span class="nc" id="L299">                JLabel buildingLabel = Utility.localizedLabel(productionWL.getLabel());</span>
<span class="nc" id="L300">                buildingLabel.setBorder(Utility.CELLBORDER);</span>
<span class="nc" id="L301">                reportPanel.add(buildingLabel, &quot;cell &quot; + BUILDING_COLUMN + &quot; &quot; + buildingStartRow + &quot; 1 &quot; + (row - buildingStartRow));</span>
<span class="nc" id="L302">                buildingStartRow = row;</span>
<span class="nc" id="L303">            } else {</span>
<span class="nc" id="L304">                reportPanel.add(createEmptyLabel(), &quot;cell &quot; + BUILDING_COLUMN + &quot; &quot; + buildingStartRow + &quot; 1 &quot; + (row - buildingStartRow));</span>
            }
        }

<span class="nc" id="L308">        row = addRow(data,</span>
<span class="nc" id="L309">                     unitName,</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">                     Messages.message(allColonists ?</span>
<span class="nc" id="L311">                         &quot;report.labour.amateursWorking&quot; :</span>
<span class="nc" id="L312">                         &quot;report.labour.workingAsOther&quot;),</span>
<span class="nc" id="L313">                     data.getWorkingAmateurs(),</span>
<span class="nc" id="L314">                     0, row);</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">        if (data.getNotWorking() &gt; 0) {</span>
<span class="nc" id="L316">            addRow(data,</span>
<span class="nc" id="L317">                   unitName,</span>
<span class="nc" id="L318">                   Messages.message(&quot;report.labour.notWorking&quot;),</span>
<span class="nc" id="L319">                   createNumberLabel(data.getNotWorking(), &quot;report.labour.notWorking.tooltip&quot;),</span>
<span class="nc" id="L320">                   0, row);</span>
<span class="nc" id="L321">            row++;</span>
        }

<span class="nc bnc" id="L324" title="All 4 branches missed.">        WorkLocation school = (colony != null &amp;&amp; data.isTraining())</span>
<span class="nc" id="L325">            ? colony.getWorkLocationWithAbility(Ability.TEACH)</span>
<span class="nc" id="L326">            : null;</span>

<span class="nc bnc" id="L328" title="All 6 branches missed.">        if (showBuildings &amp;&amp; school != null &amp;&amp; row &gt; buildingStartRow) {</span>
<span class="nc" id="L329">            reportPanel.add(createEmptyLabel(), &quot;cell &quot; + BUILDING_COLUMN</span>
<span class="nc" id="L330">                + &quot; &quot; + buildingStartRow + &quot; 1 &quot; + (row - buildingStartRow));</span>
<span class="nc" id="L331">            buildingStartRow = row;</span>
        }

<span class="nc" id="L334">        row = addRow(data,</span>
<span class="nc" id="L335">                     unitName,</span>
<span class="nc" id="L336">                     Messages.message(&quot;report.labour.teacher&quot;),</span>
<span class="nc" id="L337">                     data.getTeachers(),</span>
<span class="nc" id="L338">                     0, row);</span>
<span class="nc bnc" id="L339" title="All 2 branches missed.">        if (!allColonists) {</span>
<span class="nc" id="L340">            row = addRow(data,</span>
<span class="nc" id="L341">                         data.getOtherStudentsName(),</span>
<span class="nc" id="L342">                         Messages.message(StringTemplate</span>
<span class="nc" id="L343">                             .template(&quot;report.labour.learning&quot;)</span>
<span class="nc" id="L344">                             .addName(&quot;%unit%&quot;, data.getUnitData().getUnitName())),</span>
<span class="nc" id="L345">                         data.getOtherStudents(),</span>
<span class="nc" id="L346">                         0, row);</span>
        }

<span class="nc" id="L349">        int studentCount = data.getStudents();</span>
<span class="nc bnc" id="L350" title="All 2 branches missed.">        if (studentCount &gt; 0) {</span>
<span class="nc bnc" id="L351" title="All 2 branches missed.">            if (allColonists) {</span>
<span class="nc" id="L352">                addRow(data, null, Messages.message(&quot;report.labour.sutdent&quot;), createNonCountedLabel(studentCount), 0, row);</span>
<span class="nc" id="L353">            } else {</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">                Set&lt;UnitType&gt; resultOfTraining = (colony == null)</span>
<span class="nc" id="L355">                    ? Collections.&lt;UnitType&gt;emptySet()</span>
<span class="nc" id="L356">                    : transform(colony.getTeachers(),</span>
<span class="nc" id="L357">                        u -&gt; {</span>
<span class="nc" id="L358">                            final Unit student = u.getStudent();</span>
<span class="nc bnc" id="L359" title="All 4 branches missed.">                            return student != null &amp;&amp; student.getType() == unitType;</span>
                        },
<span class="nc" id="L361">                        u -&gt; Unit.getUnitTypeTeaching(u.getType(), u.getStudent().getType()),</span>
<span class="nc" id="L362">                        Collectors.toSet());</span>
<span class="nc bnc" id="L363" title="All 2 branches missed.">                String student = resultOfTraining.size() == 1 ?</span>
<span class="nc" id="L364">                    Messages.message(StringTemplate</span>
<span class="nc" id="L365">                        .template(&quot;report.labour.learning&quot;)</span>
<span class="nc" id="L366">                        .addName(&quot;%unit%&quot;, resultOfTraining.iterator().next())) :</span>
<span class="nc" id="L367">                    Messages.message(&quot;report.labour.learningOther&quot;);</span>
<span class="nc" id="L368">                addRow(data,</span>
<span class="nc" id="L369">                       data.getUnitData().getUnitName(),</span>
<span class="nc" id="L370">                       student,</span>
<span class="nc" id="L371">                       createNumberLabel(-studentCount, &quot;report.labour.subtracted.tooltip&quot;),</span>
<span class="nc" id="L372">                       0, row);</span>
            }
<span class="nc" id="L374">            row++;</span>
        }

<span class="nc bnc" id="L377" title="All 4 branches missed.">        if (showBuildings &amp;&amp; row &gt; buildingStartRow) {</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">            JLabel buildingLabel = new JLabel((school == null) ? &quot;&quot;</span>
<span class="nc" id="L379">                : Messages.message(school.getLabel()));</span>
<span class="nc" id="L380">            buildingLabel.setBorder(Utility.CELLBORDER);</span>
<span class="nc" id="L381">            reportPanel.add(buildingLabel, &quot;cell &quot; + BUILDING_COLUMN</span>
<span class="nc" id="L382">                + &quot; &quot; + buildingStartRow</span>
<span class="nc" id="L383">                + &quot; 1 &quot; + (row - buildingStartRow));</span>
        }

<span class="nc bnc" id="L386" title="All 4 branches missed.">        if (data.getUnitData().showProduction() &amp;&amp; row &gt; notProducingStartRow) {</span>
<span class="nc" id="L387">            reportPanel.add(createEmptyLabel(), &quot;cell &quot; + PRODUCTION_COLUMN</span>
<span class="nc" id="L388">                + &quot; &quot; + notProducingStartRow</span>
<span class="nc" id="L389">                + &quot; 1 &quot; + (row - notProducingStartRow));</span>
        }

<span class="nc" id="L392">        return row;</span>
    }

    private void addLocations() {
<span class="nc" id="L396">        LabourData.LocationData unitTotal = unitData.getTotal();</span>

<span class="nc" id="L398">        int row = 1;</span>
<span class="nc" id="L399">        JLabel summaryLabel = Utility.localizedLabel(&quot;report.labour.summary&quot;);</span>
<span class="nc" id="L400">        summaryLabel.setBorder(Utility.LEFTCELLBORDER);</span>
<span class="nc" id="L401">        reportPanel.add(summaryLabel, &quot;cell &quot; + COLONY_COLUMN + &quot; &quot; + row</span>
<span class="nc" id="L402">            + &quot; 1 &quot; + unitTotal.getRowCount());</span>

<span class="nc" id="L404">        row = addLocationData(unitTotal, null, row);</span>

<span class="nc bnc" id="L406" title="All 2 branches missed.">        for (Colony colony : getFreeColClient().getMySortedColonies()) {</span>
<span class="nc" id="L407">            LabourData.LocationData colonyData</span>
<span class="nc" id="L408">                = unitData.getDetails().get(colony);</span>
<span class="nc bnc" id="L409" title="All 2 branches missed.">            if (colonyData != null) {</span>
<span class="nc" id="L410">                reportPanel.add(createColonyButton(colony),</span>
<span class="nc" id="L411">                    &quot;cell &quot; + COLONY_COLUMN + &quot; &quot; + row</span>
<span class="nc" id="L412">                    + &quot; 1 &quot; + colonyData.getRowCount());</span>
<span class="nc" id="L413">                row = addLocationData(colonyData, colony, row);</span>
            }
        }
<span class="nc" id="L416">        LabourData.LocationData europe = unitData.getUnitsInEurope();</span>
<span class="nc bnc" id="L417" title="All 2 branches missed.">        if (europe.getRowCount() &gt; 0) {</span>
<span class="nc" id="L418">            String nam = Messages.getName(getMyPlayer().getEurope());</span>
<span class="nc" id="L419">            JButton button = createButton(nam,</span>
<span class="nc" id="L420">                (ActionEvent ae) -&gt; { getGUI().showEuropePanel(); });</span>
<span class="nc" id="L421">            reportPanel.add(button, &quot;cell &quot; + COLONY_COLUMN + &quot; &quot; + row</span>
<span class="nc" id="L422">                + &quot; 1 &quot; + europe.getRowCount());</span>
<span class="nc" id="L423">            row = addLocationData(europe, null, row);</span>
        }
<span class="nc" id="L425">        row = addNonLinkedLocation(unitData.getUnitsOnLand(),</span>
<span class="nc" id="L426">                                   &quot;report.labour.onLand&quot;, row);</span>
<span class="nc" id="L427">        row = addNonLinkedLocation(unitData.getUnitsAtSea(),</span>
<span class="nc" id="L428">                                   &quot;report.labour.atSea&quot;, row);</span>

<span class="nc" id="L430">        reportPanel.add(Utility.localizedLabel(&quot;report.labour.canTrain&quot;),</span>
<span class="nc" id="L431">                        &quot;cell 1 &quot; + row + &quot; &quot; + COLUMNS + &quot; 1&quot;);</span>
<span class="nc" id="L432">    }</span>

    /*
     * distributes {@code value}, amount the number of {@code pocketCount}
     *
     * @param value
     * @param pocketCount
     * @return distribution of {@code value}
     */
    /*
    private int[] distribute(int value, int pocketCount) {
        int[] pockets = new int[pocketCount];

        int pocketIndex = 0;
        for (int i = value; i &gt; 0; i--) {
            pockets[pocketIndex]++;

            pocketIndex++;
            pocketIndex = pocketIndex % pocketCount;
        }
        return pockets;
    }
     */

    private void addLocationSummary(LabourData.LocationData data, int row) {
<span class="nc" id="L457">        int rows = data.getRowCount();</span>

<span class="nc" id="L459">        JLabel colonistsLabel = createNumberLabel(data.getTotalColonists(), null);</span>
<span class="nc bnc" id="L460" title="All 2 branches missed.">        if (data.getUnitData().isSummary()) {</span>
<span class="nc bnc" id="L461" title="All 2 branches missed.">            if (isOverview()) {</span>
<span class="nc" id="L462">                reportPanel.add(createEmptyLabel(), &quot;cell &quot; + UNIT_TYPE_COLUMN + &quot; &quot; + row + &quot; 1 &quot; + rows);</span>
            }
<span class="nc" id="L464">        } else {</span>
<span class="nc" id="L465">            Utility.localizeToolTip(colonistsLabel, StringTemplate</span>
<span class="nc" id="L466">                .template(&quot;report.labour.unitTotal.tooltip&quot;)</span>
<span class="nc" id="L467">                .addName(&quot;%unit%&quot;, data.getUnitData().getUnitName()));</span>
        }

<span class="nc" id="L470">        reportPanel.add(colonistsLabel, &quot;cell &quot; + COLONIST_SUMMARY_COLUMN + &quot; &quot; + row + &quot; 1 &quot; + data.getRowCount());</span>

<span class="nc bnc" id="L472" title="All 4 branches missed.">        if (showProduction &amp;&amp; !data.getUnitData().showProduction()) {</span>
<span class="nc" id="L473">            reportPanel.add(createEmptyLabel(), &quot;cell &quot; + PRODUCTION_SYMBOL_COLUMN + &quot; &quot; + row + &quot; 4 &quot; + rows);</span>
<span class="nc" id="L474">            return;</span>
        }

<span class="nc bnc" id="L477" title="All 2 branches missed.">        if (showProduction) {</span>
<span class="nc" id="L478">            JLabel productionLabel = createNumberLabel(data.getTotalProduction(), &quot;report.labour.potentialProduction.tooltip&quot;);</span>
<span class="nc bnc" id="L479" title="All 4 branches missed.">            if (!data.isTotal() &amp;&amp; data.getTotalProduction() == 0) {</span>
<span class="nc" id="L480">                productionLabel.setText(&quot;&quot;);</span>
            }

<span class="nc" id="L483">            reportPanel.add(productionLabel, &quot;cell &quot; + PRODUCTION_SUMMARY_COLUMN + &quot; &quot; + row + &quot; 1 &quot; + rows);</span>
        }

<span class="nc bnc" id="L486" title="All 2 branches missed.">        if (showNetProduction) {</span>
<span class="nc" id="L487">            int net = data.getNetProduction();</span>
<span class="nc" id="L488">            JLabel netProductionLabel = createNumberLabel(net, &quot;report.labour.netProduction.tooltip&quot;);</span>

<span class="nc bnc" id="L490" title="All 6 branches missed.">            if (!data.getUnitData().showNetProduction() || (!data.isTotal() &amp;&amp; net == 0)) {</span>
<span class="nc" id="L491">                netProductionLabel.setText(&quot;&quot;);</span>
<span class="nc" id="L492">                netProductionLabel.setToolTipText(&quot;&quot;);</span>
<span class="nc bnc" id="L493" title="All 2 branches missed.">            } else if (net &gt;= 0) {</span>
<span class="nc" id="L494">                netProductionLabel.setText(&quot;+&quot; + net);</span>
<span class="nc" id="L495">            } else {</span>
<span class="nc" id="L496">                netProductionLabel.setForeground(Color.RED);</span>
            }
<span class="nc" id="L498">            reportPanel.add(netProductionLabel, &quot;cell &quot; + NETPRODUCTION_SUMMARY_COLUMN + &quot; &quot; + row + &quot; 1 &quot; + rows);</span>
        }

<span class="nc bnc" id="L501" title="All 2 branches missed.">        if (showProductionSymbols) {</span>
<span class="nc" id="L502">            JLabel icon = new JLabel();</span>
<span class="nc" id="L503">            icon.setBorder(Utility.CELLBORDER);</span>
<span class="nc" id="L504">            GoodsType goods = data.getUnitData().getExpertProduction();</span>
<span class="nc bnc" id="L505" title="All 2 branches missed.">            if (goods != null) {</span>
<span class="nc" id="L506">                icon.setIcon(new ImageIcon(getImageLibrary().getIconImage(goods)));</span>
            }
<span class="nc" id="L508">            reportPanel.add(icon, &quot;cell &quot; + PRODUCTION_SYMBOL_COLUMN + &quot; &quot; + row + &quot; 1 &quot; + rows);</span>
        }
<span class="nc" id="L510">    }</span>

    private int addNonLinkedLocation(LabourData.LocationData data, String messageKey, int row) {
<span class="nc" id="L513">        int rows = data.getRowCount();</span>
<span class="nc bnc" id="L514" title="All 2 branches missed.">        if (rows &gt; 0) {</span>
<span class="nc" id="L515">            JLabel label = Utility.localizedLabel(messageKey);</span>
<span class="nc" id="L516">            label.setBorder(Utility.LEFTCELLBORDER);</span>
<span class="nc" id="L517">            label.setForeground(Color.GRAY);</span>
<span class="nc" id="L518">            reportPanel.add(label, &quot;cell &quot; + COLONY_COLUMN + &quot; &quot; + row + &quot; 1 &quot; + rows);</span>
<span class="nc" id="L519">            return addLocationData(data, null, row);</span>
        }
<span class="nc" id="L521">        return row;</span>
    }

    private int addRow(LabourData.LocationData data, String typeName, String activity, int colonists, int production, int row) {
<span class="nc bnc" id="L525" title="All 2 branches missed.">        if (colonists &gt; 0) {</span>
<span class="nc" id="L526">            addRow(data, typeName, activity, createNumberLabel(colonists, null), production, row);</span>
<span class="nc" id="L527">            row++;</span>
        }
<span class="nc" id="L529">        return row;</span>
    }

    private void addRow(LabourData.LocationData data, String typeName, String activity, JLabel colonistLabel, int production, int row) {
<span class="nc bnc" id="L533" title="All 2 branches missed.">        if (!data.getUnitData().isSummary()) {</span>
<span class="nc" id="L534">            JLabel typeLabel = new JLabel(typeName);</span>
<span class="nc" id="L535">            typeLabel.setBorder(Utility.CELLBORDER);</span>
<span class="nc" id="L536">            reportPanel.add(typeLabel, &quot;cell &quot; + UNIT_TYPE_COLUMN + &quot; &quot; + row);</span>
        }

<span class="nc" id="L539">        JLabel activityLabel = new JLabel(activity);</span>
<span class="nc" id="L540">        activityLabel.setBorder(Utility.CELLBORDER);</span>
<span class="nc" id="L541">        reportPanel.add(activityLabel, &quot;cell &quot; + WORKING_COLUMN + &quot; &quot; + row);</span>

<span class="nc" id="L543">        reportPanel.add(colonistLabel, &quot;cell &quot; + COLONIST_COLUMN + &quot; &quot; + row);</span>

<span class="nc bnc" id="L545" title="All 4 branches missed.">        if (data.getUnitData().showProduction() &amp;&amp; production &gt; 0) {</span>
<span class="nc" id="L546">            reportPanel.add(createNumberLabel(production, &quot;report.labour.potentialProduction.tooltip&quot;), &quot;cell &quot; + PRODUCTION_COLUMN + &quot; &quot; + row);</span>
        }
<span class="nc" id="L548">    }</span>

    private void addUnitTypes() {
<span class="nc" id="L551">        int row = 1;</span>

<span class="nc" id="L553">        JButton allColonistsButton = createUnitNameButton(Messages.message(&quot;report.labour.allColonists&quot;), labourData.getSummary());</span>
<span class="nc" id="L554">        reportPanel.add(allColonistsButton, &quot;cell &quot; + COLONY_COLUMN + &quot; &quot; + row + &quot; 1 &quot; + labourData.getSummary().getUnitSummaryRowCount());</span>

<span class="nc" id="L556">        row = addLocationData(labourData.getSummary().getTotal(), null, row);</span>

<span class="nc bnc" id="L558" title="All 2 branches missed.">        for (UnitType unitType : LabourData.getLabourTypes(getMyPlayer())) {</span>
<span class="nc" id="L559">            LabourData.UnitData unitData = labourData.getUnitData(unitType);</span>

<span class="nc" id="L561">            JButton unitButton = createUnitNameButton(unitData.getUnitName(), unitData);</span>
<span class="nc" id="L562">            int rows = unitData.getUnitSummaryRowCount();</span>
<span class="nc" id="L563">            reportPanel.add(unitButton, &quot;cell &quot; + COLONY_COLUMN + &quot; &quot; + row + &quot; 1 &quot; + rows);</span>

<span class="nc bnc" id="L565" title="All 2 branches missed.">            if (unitData.hasDetails()) {</span>
<span class="nc" id="L566">                row = addLocationData(unitData.getTotal(), null, row);</span>
<span class="nc" id="L567">            } else {</span>
<span class="nc" id="L568">                unitButton.setEnabled(false);</span>
<span class="nc" id="L569">                unitButton.setDisabledIcon(unitButton.getIcon());</span>
<span class="nc" id="L570">                unitButton.setForeground(Color.GRAY);</span>

<span class="nc" id="L572">                reportPanel.add(createEmptyLabel(), &quot;cell &quot; + UNIT_TYPE_COLUMN + &quot; &quot; + row + &quot; &quot; + (COLUMNS - 1) + &quot; 1&quot;);</span>
<span class="nc" id="L573">                row++;</span>
            }
        }
<span class="nc" id="L576">    }</span>

    private JButton createButton(String name, ActionListener listener) {
<span class="nc" id="L579">        JButton button = new JButton(name);</span>
<span class="nc" id="L580">        button.setMargin(new Insets(0, 0, 0, 0));</span>
<span class="nc" id="L581">        button.setOpaque(false);</span>
<span class="nc" id="L582">        button.setHorizontalAlignment(SwingConstants.LEADING);</span>
<span class="nc" id="L583">        button.setForeground(Utility.LINK_COLOR);</span>
<span class="nc" id="L584">        button.setBorder(Utility.LEFTCELLBORDER);</span>
<span class="nc" id="L585">        button.addActionListener(listener);</span>
<span class="nc" id="L586">        return button;</span>
    }

    private JLabel createEmptyLabel() {
<span class="nc" id="L590">        JLabel empty = new JLabel();</span>
<span class="nc" id="L591">        empty.setBorder(Utility.CELLBORDER);</span>
<span class="nc" id="L592">        return empty;</span>
    }

    private JLabel createNonCountedLabel(int otherAmateurs) {
<span class="nc" id="L596">        JLabel label = createNumberLabel(otherAmateurs,</span>
<span class="nc" id="L597">                                         &quot;report.labour.notCounted.tooltip&quot;);</span>
<span class="nc" id="L598">        label.setForeground(Color.GRAY);</span>
<span class="nc" id="L599">        return label;</span>
    }

    private JLabel createNumberLabel(int number, String toolTipKey) {
<span class="nc" id="L603">        JLabel label = new JLabel(String.valueOf(number));</span>
<span class="nc" id="L604">        label.setHorizontalAlignment(SwingConstants.TRAILING);</span>
<span class="nc" id="L605">        label.setBorder(Utility.CELLBORDER);</span>
<span class="nc bnc" id="L606" title="All 2 branches missed.">        if (toolTipKey != null) Utility.localizeToolTip(this, toolTipKey);</span>
<span class="nc" id="L607">        return label;</span>
    }

    private JButton createUnitNameButton(String name,
                                         LabourData.UnitData unitData) {
<span class="nc" id="L612">        JButton button = createButton(name, (ActionEvent ae) -&gt; {</span>
<span class="nc" id="L613">                getGUI().showCompactLabourReport(unitData);</span>
<span class="nc" id="L614">            });</span>

<span class="nc bnc" id="L616" title="All 2 branches missed.">        if (!unitData.isSummary()) {</span>
<span class="nc" id="L617">            button.setIcon(new ImageIcon(</span>
<span class="nc" id="L618">                getImageLibrary().getUnitImage(unitData.getUnitType())));</span>
        }

<span class="nc" id="L621">        return button;</span>
    }

    private GoodsType getGoodsType() {
<span class="nc bnc" id="L625" title="All 2 branches missed.">        return (isSummary()) ? null</span>
<span class="nc" id="L626">            : unitData.getUnitType().getExpertProduction();</span>
    }

    /**
     * Is this an overview/location summary?
     *
     * @return True if this is the location summary.
     */
    private boolean isOverview() {
<span class="nc bnc" id="L635" title="All 2 branches missed.">        return unitData == null;</span>
    }

    /**
     * Is this a summary?
     *
     * @return True if this is any sort of summary.
     */
    private boolean isSummary() {
<span class="nc bnc" id="L644" title="All 4 branches missed.">        return isOverview() || unitData.isSummary();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span>src (May 7, 2016 6:04:12 PM)</div></body></html>