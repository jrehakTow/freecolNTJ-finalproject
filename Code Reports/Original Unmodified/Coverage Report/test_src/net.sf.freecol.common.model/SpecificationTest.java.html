<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>SpecificationTest.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">src (May 7, 2016 6:04:12 PM)</a> &gt; <a href="../../index.html" class="el_group">FreeCol</a> &gt; <a href="../index.html" class="el_bundle">test/src</a> &gt; <a href="index.source.html" class="el_package">net.sf.freecol.common.model</a> &gt; <span class="el_source">SpecificationTest.java</span></div><h1>SpecificationTest.java</h1><pre class="source lang-java linenums">/**
 *  Copyright (C) 2002-2016  The FreeCol Team
 *
 *  This file is part of FreeCol.
 *
 *  FreeCol is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  FreeCol is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with FreeCol.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */

package net.sf.freecol.common.model;

import java.io.ByteArrayInputStream;
import java.io.File;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;

import net.sf.freecol.common.io.FreeColModFile;
import net.sf.freecol.common.io.FreeColTcFile;
import net.sf.freecol.common.model.Modifier;
import net.sf.freecol.common.model.Modifier.ModifierType;
import net.sf.freecol.util.test.FreeColTestCase;


<span class="fc" id="L37">public final class SpecificationTest extends FreeColTestCase {</span>

<span class="fc" id="L39">    private static final BuildingType depotType</span>
<span class="fc" id="L40">        = spec().getBuildingType(&quot;model.building.depot&quot;);</span>

<span class="fc" id="L42">    private static final GoodsType fishType</span>
<span class="fc" id="L43">        = spec().getGoodsType(&quot;model.goods.fish&quot;);</span>
<span class="fc" id="L44">    private static final GoodsType foodType</span>
<span class="fc" id="L45">        = spec().getPrimaryFoodType();</span>
<span class="fc" id="L46">    private static final GoodsType horsesType</span>
<span class="fc" id="L47">        = spec().getGoodsType(&quot;model.goods.horses&quot;);</span>
<span class="fc" id="L48">    private static final GoodsType musketsType</span>
<span class="fc" id="L49">        = spec().getGoodsType(&quot;model.goods.muskets&quot;);</span>
<span class="fc" id="L50">    private static final GoodsType toolsType</span>
<span class="fc" id="L51">        = spec().getGoodsType(&quot;model.goods.tools&quot;);</span>

<span class="fc" id="L53">    private static final Role armedBraveRole</span>
<span class="fc" id="L54">        = spec().getRole(&quot;model.role.armedBrave&quot;);</span>
<span class="fc" id="L55">    private static final Role cavalryRole</span>
<span class="fc" id="L56">        = spec().getRole(&quot;model.role.cavalry&quot;);</span>
<span class="fc" id="L57">    private static final Role dragoonRole</span>
<span class="fc" id="L58">        = spec().getRole(&quot;model.role.dragoon&quot;);</span>
<span class="fc" id="L59">    private static final Role infantryRole</span>
<span class="fc" id="L60">        = spec().getRole(&quot;model.role.infantry&quot;);</span>
<span class="fc" id="L61">    private static final Role missionaryRole</span>
<span class="fc" id="L62">        = spec().getRole(&quot;model.role.missionary&quot;);</span>
<span class="fc" id="L63">    private static final Role nativeDragoonRole</span>
<span class="fc" id="L64">        = spec().getRole(&quot;model.role.nativeDragoon&quot;);</span>
<span class="fc" id="L65">    private static final Role soldierRole</span>
<span class="fc" id="L66">        = spec().getRole(&quot;model.role.soldier&quot;);</span>

<span class="fc" id="L68">    private static final UnitType blackSmithType</span>
<span class="fc" id="L69">        = spec().getUnitType(&quot;model.unit.masterBlacksmith&quot;);</span>
<span class="fc" id="L70">    private static final UnitType braveType</span>
<span class="fc" id="L71">        = spec().getUnitType(&quot;model.unit.brave&quot;);</span>
<span class="fc" id="L72">    private static final UnitType caravelType</span>
<span class="fc" id="L73">        = spec().getUnitType(&quot;model.unit.caravel&quot;);</span>
<span class="fc" id="L74">    private static final UnitType freeColonistType</span>
<span class="fc" id="L75">        = spec().getUnitType(&quot;model.unit.freeColonist&quot;);</span>
<span class="fc" id="L76">    private static final UnitType kingsRegularType</span>
<span class="fc" id="L77">        = spec().getUnitType(&quot;model.unit.kingsRegular&quot;);</span>
<span class="fc" id="L78">    private static final UnitType privateerType</span>
<span class="fc" id="L79">        = spec().getUnitType(&quot;model.unit.privateer&quot;);</span>
<span class="fc" id="L80">    private static final UnitType wagonType</span>
<span class="fc" id="L81">        = spec().getUnitType(&quot;model.unit.wagonTrain&quot;);</span>


    /**
     * Make sure that a specification object can be created without an exception
     * being thrown.
     */
    public void testLoad() {
<span class="fc" id="L89">        Specification spec = null;</span>
        try {
<span class="fc" id="L91">            spec = new FreeColTcFile(&quot;freecol&quot;).getSpecification();</span>
<span class="pc" id="L92">        } catch (Exception e) {</span>
<span class="nc" id="L93">            e.printStackTrace();</span>
<span class="nc" id="L94">            fail();</span>
        }
<span class="fc" id="L96">        assertNotNull(spec);</span>
<span class="fc" id="L97">    }</span>

    /**
     * Test for some typical abilities.
     */
    public void testUnitAbilities() {
<span class="fc" id="L103">        assertTrue(freeColonistType.hasAbility(Ability.FOUND_COLONY));</span>
<span class="fc" id="L104">        assertFalse(freeColonistType.hasAbility(Ability.BORN_IN_INDIAN_SETTLEMENT));</span>
<span class="fc" id="L105">        assertTrue(freeColonistType.isRecruitable());</span>
<span class="fc" id="L106">        assertFalse(freeColonistType.hasAbility(Ability.NAVAL_UNIT));</span>
<span class="fc" id="L107">        assertFalse(freeColonistType.hasAbility(Ability.CARRY_GOODS));</span>
<span class="fc" id="L108">        assertFalse(freeColonistType.hasAbility(Ability.CARRY_UNITS));</span>
<span class="fc" id="L109">        assertFalse(freeColonistType.hasAbility(Ability.CAPTURE_GOODS));</span>

<span class="fc" id="L111">        assertFalse(wagonType.hasAbility(Ability.FOUND_COLONY));</span>
<span class="fc" id="L112">        assertFalse(wagonType.isRecruitable());</span>
<span class="fc" id="L113">        assertFalse(wagonType.hasAbility(Ability.NAVAL_UNIT));</span>
<span class="fc" id="L114">        assertTrue(wagonType.hasAbility(Ability.CARRY_GOODS));</span>
<span class="fc" id="L115">        assertFalse(wagonType.hasAbility(Ability.CARRY_UNITS));</span>
<span class="fc" id="L116">        assertFalse(wagonType.hasAbility(Ability.CAPTURE_GOODS));</span>

        //assertFalse(brave.hasAbility(Ability.FOUND_COLONY));
<span class="fc" id="L119">        assertTrue(braveType.hasAbility(Ability.BORN_IN_INDIAN_SETTLEMENT));</span>
<span class="fc" id="L120">        assertFalse(braveType.isRecruitable());</span>
<span class="fc" id="L121">        assertFalse(braveType.hasAbility(Ability.NAVAL_UNIT));</span>
<span class="fc" id="L122">        assertTrue(braveType.hasAbility(Ability.CARRY_GOODS));</span>
<span class="fc" id="L123">        assertFalse(braveType.hasAbility(Ability.CARRY_UNITS));</span>
<span class="fc" id="L124">        assertFalse(braveType.hasAbility(Ability.CAPTURE_GOODS));</span>

<span class="fc" id="L126">        assertFalse(caravelType.hasAbility(Ability.FOUND_COLONY));</span>
<span class="fc" id="L127">        assertFalse(caravelType.isRecruitable());</span>
<span class="fc" id="L128">        assertTrue(caravelType.hasAbility(Ability.NAVAL_UNIT));</span>
<span class="fc" id="L129">        assertTrue(caravelType.hasAbility(Ability.CARRY_GOODS));</span>
<span class="fc" id="L130">        assertTrue(caravelType.hasAbility(Ability.CARRY_UNITS));</span>
<span class="fc" id="L131">        assertFalse(caravelType.hasAbility(Ability.CAPTURE_GOODS));</span>

<span class="fc" id="L133">        assertFalse(privateerType.hasAbility(Ability.FOUND_COLONY));</span>
<span class="fc" id="L134">        assertFalse(privateerType.isRecruitable());</span>
<span class="fc" id="L135">        assertTrue(privateerType.hasAbility(Ability.NAVAL_UNIT));</span>
<span class="fc" id="L136">        assertTrue(privateerType.hasAbility(Ability.CARRY_GOODS));</span>
<span class="fc" id="L137">        assertTrue(privateerType.hasAbility(Ability.CARRY_UNITS));</span>
<span class="fc" id="L138">        assertTrue(privateerType.hasAbility(Ability.CAPTURE_GOODS));</span>
<span class="fc" id="L139">    }</span>

    public void testFoundingFathers() {
<span class="fc" id="L142">        final FoundingFather smith</span>
<span class="fc" id="L143">            = spec().getFoundingFather(&quot;model.foundingFather.adamSmith&quot;);</span>
<span class="fc" id="L144">        assertNotNull(smith);</span>
<span class="fc" id="L145">        assertEquals(FoundingFather.FoundingFatherType.TRADE, smith.getType());</span>
        // weight is some value in [0, 10]
<span class="pc bpc" id="L147" title="1 of 2 branches missed.">        assertTrue(smith.getWeight(0) &gt;= 0);</span>
<span class="pc bpc" id="L148" title="1 of 2 branches missed.">        assertTrue(smith.getWeight(1) &gt;= 0);</span>
<span class="pc bpc" id="L149" title="1 of 2 branches missed.">        assertTrue(smith.getWeight(2) &gt;= 0);</span>
<span class="pc bpc" id="L150" title="1 of 2 branches missed.">        assertTrue(smith.getWeight(0) &lt;= 10);</span>
<span class="pc bpc" id="L151" title="1 of 2 branches missed.">        assertTrue(smith.getWeight(1) &lt;= 10);</span>
<span class="pc bpc" id="L152" title="1 of 2 branches missed.">        assertTrue(smith.getWeight(2) &lt;= 10);</span>

<span class="fc" id="L154">        assertEquals(0, smith.getWeight(-1));</span>
<span class="fc" id="L155">        assertEquals(0, smith.getWeight(34));</span>
        // check for ability
<span class="fc" id="L157">        assertTrue(smith.hasAbility(Ability.BUILD_FACTORY));</span>
<span class="fc" id="L158">    }</span>

    public void testModifiers() {
        // Percentage Modifier
        /*
        BuildingType ironWorks = spec.getBuildingType(&quot;model.building.ironWorks&quot;);
        Modifier modifier = ironWorks.getModifiers(&quot;model.goods.tools&quot;).iterator().next();
        assertEquals(Modifier.Type.PERCENTAGE, modifier.getType());
        assertEquals(50f, modifier.getValue());
        */

        // Additive Modifier
<span class="fc" id="L170">        Modifier modifier = depotType</span>
<span class="fc" id="L171">            .getModifiers(Modifier.WAREHOUSE_STORAGE).iterator().next();</span>
<span class="fc" id="L172">        assertEquals(ModifierType.ADDITIVE, modifier.getType());</span>
<span class="fc" id="L173">        assertEquals(100f, modifier.getValue());</span>

        // Multiplicative Modifier
<span class="fc" id="L176">        modifier = blackSmithType.getModifiers(&quot;model.goods.tools&quot;).iterator().next();</span>
<span class="fc" id="L177">        assertEquals(ModifierType.MULTIPLICATIVE, modifier.getType());</span>
<span class="fc" id="L178">        assertEquals(2f, modifier.getValue());</span>
<span class="fc" id="L179">    }</span>

    public void testNations() {
        // 4 original European nations, 4 in freecol rules
        // The unknown enemy is deliberately absent from the European
        // nations list
<span class="fc" id="L185">        List&lt;Nation&gt; europeanNations = spec().getEuropeanNations();</span>
<span class="fc" id="L186">        assertEquals(8, europeanNations.size());</span>

        // 8 original native nations
<span class="fc" id="L189">        List&lt;Nation&gt; indianNations = spec().getIndianNations();</span>
<span class="fc" id="L190">        assertEquals(8, indianNations.size());</span>

        // Unknown enemy has no REF
<span class="fc" id="L193">        List&lt;Nation&gt; REFNations = spec().getREFNations();</span>
<span class="fc" id="L194">        assertEquals(europeanNations.size(), REFNations.size());</span>
<span class="fc" id="L195">    }</span>

    public void testNationTypes() {
<span class="fc" id="L198">        final Specification spec = spec();</span>

<span class="fc" id="L200">        List&lt;IndianNationType&gt; indianNationTypes = spec.getIndianNationTypes();</span>
<span class="fc" id="L201">        assertEquals(8, indianNationTypes.size());</span>
<span class="fc" id="L202">        List&lt;EuropeanNationType&gt; REFNationTypes = spec.getREFNationTypes();</span>
<span class="fc" id="L203">        assertEquals(1, REFNationTypes.size());</span>

<span class="fc" id="L205">    }</span>

    public void testRequiredAbilitiesForRoles() {
<span class="fc" id="L208">        final Specification spec = spec();</span>
        Map&lt;String, Boolean&gt; abilitiesReq, expectAbilities;
<span class="fc" id="L210">        Map&lt;String, Map&lt;String, Boolean&gt;&gt; roleAbilities = new HashMap&lt;&gt;();</span>

<span class="fc" id="L212">        expectAbilities = new HashMap&lt;&gt;();</span>
<span class="fc" id="L213">        expectAbilities.put(Ability.CAN_BE_EQUIPPED, true);</span>
<span class="fc" id="L214">        expectAbilities.put(Ability.NATIVE, false);</span>
<span class="fc" id="L215">        expectAbilities.put(Ability.REF_UNIT, false);</span>
<span class="fc" id="L216">        roleAbilities.put(&quot;model.role.scout&quot;, expectAbilities);</span>

<span class="fc" id="L218">        expectAbilities = new HashMap&lt;&gt;();</span>
<span class="fc" id="L219">        expectAbilities.put(Ability.CAN_BE_EQUIPPED, true);</span>
<span class="fc" id="L220">        expectAbilities.put(Ability.NATIVE, false);</span>
<span class="fc" id="L221">        expectAbilities.put(Ability.REF_UNIT, false);</span>
<span class="fc" id="L222">        roleAbilities.put(&quot;model.role.soldier&quot;, expectAbilities);</span>

<span class="fc" id="L224">        expectAbilities = new HashMap&lt;&gt;();</span>
<span class="fc" id="L225">        expectAbilities.put(Ability.CAN_BE_EQUIPPED, true);</span>
<span class="fc" id="L226">        expectAbilities.put(Ability.NATIVE, false);</span>
<span class="fc" id="L227">        expectAbilities.put(Ability.REF_UNIT, false);</span>
<span class="fc" id="L228">        roleAbilities.put(&quot;model.role.dragoon&quot;, expectAbilities);</span>

<span class="fc" id="L230">        expectAbilities = new HashMap&lt;&gt;();</span>
<span class="fc" id="L231">        expectAbilities.put(Ability.CAN_BE_EQUIPPED, true);</span>
<span class="fc" id="L232">        expectAbilities.put(Ability.NATIVE, false);</span>
<span class="fc" id="L233">        expectAbilities.put(Ability.REF_UNIT, false);</span>
<span class="fc" id="L234">        roleAbilities.put(&quot;model.role.pioneer&quot;, expectAbilities);</span>

<span class="fc" id="L236">        expectAbilities = new HashMap&lt;&gt;();</span>
<span class="fc" id="L237">        expectAbilities.put(Ability.CAN_BE_EQUIPPED, true);</span>
<span class="fc" id="L238">        expectAbilities.put(Ability.DRESS_MISSIONARY, true);</span>
<span class="fc" id="L239">        expectAbilities.put(Ability.NATIVE, false);</span>
<span class="fc" id="L240">        expectAbilities.put(Ability.REF_UNIT, false);</span>
<span class="fc" id="L241">        roleAbilities.put(&quot;model.role.missionary&quot;, expectAbilities);</span>

<span class="fc" id="L243">        expectAbilities = new HashMap&lt;&gt;();</span>
<span class="fc" id="L244">        expectAbilities.put(Ability.CAN_BE_EQUIPPED, true);</span>
<span class="fc" id="L245">        expectAbilities.put(Ability.NATIVE, false);</span>
<span class="fc" id="L246">        expectAbilities.put(Ability.REF_UNIT, true);</span>
<span class="fc" id="L247">        expectAbilities.put(Ability.ROYAL_EXPEDITIONARY_FORCE, true);</span>
<span class="fc" id="L248">        roleAbilities.put(&quot;model.role.infantry&quot;, expectAbilities);</span>

<span class="fc" id="L250">        expectAbilities = new HashMap&lt;&gt;();</span>
<span class="fc" id="L251">        expectAbilities.put(Ability.CAN_BE_EQUIPPED, true);</span>
<span class="fc" id="L252">        expectAbilities.put(Ability.NATIVE, false);</span>
<span class="fc" id="L253">        expectAbilities.put(Ability.REF_UNIT, true);</span>
<span class="fc" id="L254">        expectAbilities.put(Ability.ROYAL_EXPEDITIONARY_FORCE, true);</span>
<span class="fc" id="L255">        roleAbilities.put(&quot;model.role.cavalry&quot;, expectAbilities);</span>

<span class="fc" id="L257">        expectAbilities = new HashMap&lt;&gt;();</span>
<span class="fc" id="L258">        expectAbilities.put(Ability.CAN_BE_EQUIPPED, true);</span>
<span class="fc" id="L259">        expectAbilities.put(Ability.NATIVE, true);</span>
<span class="fc" id="L260">        expectAbilities.put(Ability.REF_UNIT, false);</span>
<span class="fc" id="L261">        roleAbilities.put(&quot;model.role.mountedBrave&quot;, expectAbilities);</span>

<span class="fc" id="L263">        expectAbilities = new HashMap&lt;&gt;();</span>
<span class="fc" id="L264">        expectAbilities.put(Ability.CAN_BE_EQUIPPED, true);</span>
<span class="fc" id="L265">        expectAbilities.put(Ability.NATIVE, true);</span>
<span class="fc" id="L266">        expectAbilities.put(Ability.REF_UNIT, false);</span>
<span class="fc" id="L267">        roleAbilities.put(&quot;model.role.armedBrave&quot;, expectAbilities);</span>

<span class="fc" id="L269">        expectAbilities = new HashMap&lt;&gt;();</span>
<span class="fc" id="L270">        expectAbilities.put(Ability.CAN_BE_EQUIPPED, true);</span>
<span class="fc" id="L271">        expectAbilities.put(Ability.NATIVE, true);</span>
<span class="fc" id="L272">        expectAbilities.put(Ability.REF_UNIT, false);</span>
<span class="fc" id="L273">        roleAbilities.put(&quot;model.role.nativeDragoon&quot;, expectAbilities);</span>

        // Verify
<span class="fc bfc" id="L276" title="All 2 branches covered.">        for (Entry&lt;String, Map&lt;String, Boolean&gt;&gt; entry</span>
<span class="fc" id="L277">                 : roleAbilities.entrySet()) {</span>
<span class="fc" id="L278">            Role role = spec.getRole(entry.getKey());</span>
<span class="fc" id="L279">            Map&lt;String, Boolean&gt; required = role.getRequiredAbilities();</span>
<span class="fc" id="L280">            expectAbilities = entry.getValue();</span>
<span class="fc bfc" id="L281" title="All 2 branches covered.">            for (String key : required.keySet()) {</span>
<span class="fc" id="L282">                Boolean req = required.get(key);</span>
<span class="fc" id="L283">                Boolean val = expectAbilities.get(key);</span>
<span class="fc" id="L284">                assertNotNull(role.getId() + &quot; missing &quot; + key, val);</span>
<span class="fc" id="L285">                assertEquals(role.getId() + &quot; &quot; + key + &quot; value != &quot; + req,</span>
<span class="fc" id="L286">                    req, val);</span>
<span class="fc" id="L287">                expectAbilities.remove(key);</span>
            }
<span class="fc" id="L289">            assertEquals(role.getId() + &quot; excess abilities&quot;, 0,</span>
<span class="fc" id="L290">                expectAbilities.size());</span>
        }

        Role role;
<span class="fc" id="L294">        role = spec.getRole(&quot;model.role.default&quot;);</span>
<span class="fc" id="L295">        assertNotNull(role);</span>
<span class="fc" id="L296">        checkGoods(role.getId(), role.getRequiredGoods());</span>

<span class="fc" id="L298">        role = spec.getRole(&quot;model.role.scout&quot;);</span>
<span class="fc" id="L299">        assertNotNull(role);</span>
<span class="fc" id="L300">        checkGoods(role.getId(), role.getRequiredGoods(),</span>
<span class="fc" id="L301">            new AbstractGoods(horsesType, 50));</span>

<span class="fc" id="L303">        role = spec.getRole(&quot;model.role.soldier&quot;);</span>
<span class="fc" id="L304">        assertNotNull(role);</span>
<span class="fc" id="L305">        checkGoods(role.getId(), role.getRequiredGoods(),</span>
<span class="fc" id="L306">            new AbstractGoods(musketsType, 50));</span>

<span class="fc" id="L308">        role = spec.getRole(&quot;model.role.dragoon&quot;);</span>
<span class="fc" id="L309">        assertNotNull(role);</span>
<span class="fc" id="L310">        checkGoods(role.getId(), role.getRequiredGoods(),</span>
<span class="fc" id="L311">            new AbstractGoods(horsesType, 50),</span>
<span class="fc" id="L312">            new AbstractGoods(musketsType, 50));</span>

<span class="fc" id="L314">        role = spec.getRole(&quot;model.role.pioneer&quot;);</span>
<span class="fc" id="L315">        assertNotNull(role);</span>
<span class="fc" id="L316">        checkGoods(role.getId(), role.getRequiredGoods(),</span>
<span class="fc" id="L317">            new AbstractGoods(toolsType, 20));</span>

<span class="fc" id="L319">        role = spec.getRole(&quot;model.role.missionary&quot;);</span>
<span class="fc" id="L320">        assertNotNull(role);</span>
<span class="fc" id="L321">        checkGoods(role.getId(), role.getRequiredGoods());</span>

<span class="fc" id="L323">        role = spec.getRole(&quot;model.role.infantry&quot;);</span>
<span class="fc" id="L324">        assertNotNull(role);</span>
<span class="fc" id="L325">        checkGoods(role.getId(), role.getRequiredGoods(),</span>
<span class="fc" id="L326">            new AbstractGoods(musketsType, 50));</span>

<span class="fc" id="L328">        role = spec.getRole(&quot;model.role.cavalry&quot;);</span>
<span class="fc" id="L329">        assertNotNull(role);</span>
<span class="fc" id="L330">        checkGoods(role.getId(), role.getRequiredGoods(),</span>
<span class="fc" id="L331">            new AbstractGoods(horsesType, 50),</span>
<span class="fc" id="L332">            new AbstractGoods(musketsType, 50));</span>

<span class="fc" id="L334">        role = spec.getRole(&quot;model.role.mountedBrave&quot;);</span>
<span class="fc" id="L335">        assertNotNull(role);</span>
<span class="fc" id="L336">        checkGoods(role.getId(), role.getRequiredGoods(),</span>
<span class="fc" id="L337">            new AbstractGoods(horsesType, 25));</span>

<span class="fc" id="L339">        role = spec.getRole(&quot;model.role.armedBrave&quot;);</span>
<span class="fc" id="L340">        assertNotNull(role);</span>
<span class="fc" id="L341">        checkGoods(role.getId(), role.getRequiredGoods(),</span>
<span class="fc" id="L342">            new AbstractGoods(musketsType, 25));</span>

<span class="fc" id="L344">        role = spec.getRole(&quot;model.role.nativeDragoon&quot;);</span>
<span class="fc" id="L345">        assertNotNull(role);</span>
<span class="fc" id="L346">        checkGoods(role.getId(), role.getRequiredGoods(),</span>
<span class="fc" id="L347">            new AbstractGoods(horsesType, 25),</span>
<span class="fc" id="L348">            new AbstractGoods(musketsType, 25));</span>
<span class="fc" id="L349">    }</span>

    public void testGoodsTypes() {
<span class="fc" id="L352">        assertTrue(foodType.isFarmed());</span>
<span class="fc" id="L353">        assertTrue(spec().getFarmedGoodsTypeList().contains(foodType));</span>
<span class="fc" id="L354">        assertTrue(foodType.isFoodType());</span>
<span class="fc" id="L355">        assertTrue(spec().getFoodGoodsTypeList().contains(foodType));</span>

<span class="fc" id="L357">        assertTrue(fishType.isFarmed());</span>
<span class="fc" id="L358">        assertTrue(spec().getFarmedGoodsTypeList().contains(fishType));</span>
<span class="fc" id="L359">        assertTrue(fishType.isFoodType());</span>
<span class="fc" id="L360">        assertTrue(spec().getFoodGoodsTypeList().contains(fishType));</span>
<span class="fc" id="L361">    }</span>

    public void testExtends() {
<span class="fc" id="L364">        String specification = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;&quot;</span>
            + &quot;&lt;freecol-specification id=\&quot;test\&quot; extends=\&quot;freecol\&quot;&gt;&quot;
            + &quot;&lt;unit-types&gt;&quot;
            + &quot;&lt;unit-type id=\&quot;model.unit.milkmaid\&quot; extends=\&quot;colonist\&quot; &quot;
            + &quot;expert-production=\&quot;model.goods.food\&quot; /&gt;&quot;
            + &quot;&lt;/unit-types&gt;&quot;
            + &quot;&lt;/freecol-specification&gt;&quot;;

<span class="fc" id="L372">        Specification spec = new Specification(new ByteArrayInputStream(specification.getBytes()));</span>

<span class="fc" id="L374">        assertNotNull(spec.getUnitType(&quot;model.unit.milkmaid&quot;));</span>
<span class="fc" id="L375">        assertNotNull(spec.getUnitType(&quot;model.unit.caravel&quot;));</span>

        // restore original values
        try {
<span class="fc" id="L379">            spec = new Specification(new FreeColTcFile(&quot;freecol&quot;).getSpecificationInputStream());</span>
<span class="pc" id="L380">        } catch (Exception e) {</span>
<span class="nc" id="L381">            System.out.println(e);</span>
        }
<span class="fc" id="L383">    }</span>

    public void testExtendsDelete() {
<span class="fc" id="L386">        String specification = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;&quot;</span>
            + &quot;&lt;freecol-specification id=\&quot;test\&quot; extends=\&quot;freecol\&quot;&gt;&quot;
            + &quot;&lt;unit-types&gt;&quot;
            + &quot;&lt;delete id=\&quot;model.unit.caravel\&quot; /&gt;&quot;
            + &quot;&lt;/unit-types&gt;&quot;
            + &quot;&lt;/freecol-specification&gt;&quot;;

<span class="fc" id="L393">        Specification spec = new Specification(new ByteArrayInputStream(specification.getBytes()));</span>

        try {
<span class="nc" id="L396">            spec.getUnitType(&quot;model.unit.caravel&quot;);</span>
<span class="nc" id="L397">            fail(&quot;Caravel is defined.&quot;);</span>
<span class="pc" id="L398">        } catch (IllegalArgumentException e) {</span>
        }

<span class="fc bfc" id="L401" title="All 2 branches covered.">        for (UnitType unitType : spec.getUnitTypeList()) {</span>
<span class="fc" id="L402">            assertFalse(&quot;model.unit.caravel&quot;.equals(unitType.getId()));</span>
        }

        // restore original values
        try {
<span class="fc" id="L407">            spec = new Specification(new FreeColTcFile(&quot;freecol&quot;).getSpecificationInputStream());</span>
<span class="pc" id="L408">        } catch (Exception e) {</span>
<span class="nc" id="L409">            System.out.println(e);</span>
        }
<span class="fc" id="L411">    }</span>

    public void testGetDefaultUnitType() {
<span class="fc" id="L414">        NationType europeanNationType = null;</span>
<span class="fc" id="L415">        NationType nativeNationType = null;</span>
<span class="fc" id="L416">        NationType refNationType = null;</span>
<span class="fc bfc" id="L417" title="All 2 branches covered.">        for (NationType nt : spec().getNationTypes()) {</span>
<span class="fc bfc" id="L418" title="All 2 branches covered.">            if (nt.isIndian()) {</span>
<span class="fc bfc" id="L419" title="All 2 branches covered.">                if (nativeNationType == null) nativeNationType = nt;</span>
<span class="fc bfc" id="L420" title="All 2 branches covered.">            } else if (nt.isREF()) {</span>
<span class="pc bpc" id="L421" title="1 of 2 branches missed.">                if (refNationType == null) refNationType = nt;</span>
<span class="fc" id="L422">            } else {</span>
<span class="fc bfc" id="L423" title="All 2 branches covered.">                if (europeanNationType == null) europeanNationType = nt;</span>
            }
        }
<span class="fc" id="L426">        assertNotNull(&quot;No European nation type&quot;, europeanNationType);</span>
<span class="fc" id="L427">        assertNotNull(&quot;No native nation type&quot;, nativeNationType);</span>
<span class="fc" id="L428">        assertNotNull(&quot;No REF nation type&quot;, refNationType);</span>
                
<span class="fc" id="L430">        assertEquals(&quot;Should find free colonist&quot;, freeColonistType,</span>
<span class="fc" id="L431">                     spec().getDefaultUnitType(europeanNationType));</span>
<span class="fc" id="L432">        assertEquals(&quot;Should find brave&quot;, braveType,</span>
<span class="fc" id="L433">                     spec().getDefaultUnitType(nativeNationType));</span>
<span class="fc" id="L434">        assertEquals(&quot;Should find kings regular&quot;, kingsRegularType,</span>
<span class="fc" id="L435">                     spec().getDefaultUnitType(refNationType));</span>
<span class="fc" id="L436">    }        </span>
        
    public void testLoadMods() {
        try {
<span class="fc" id="L440">            Specification specification = new Specification(new FreeColTcFile(&quot;freecol&quot;).getSpecificationInputStream());</span>
<span class="fc" id="L441">            int numberOfUnitTypes = specification.getUnitTypeList().size();</span>
<span class="fc" id="L442">            List&lt;FreeColModFile&gt; mods = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L443">            mods.add(new FreeColModFile(new File(&quot;data/mods/example&quot;)));</span>
<span class="fc" id="L444">            specification.loadMods(mods);</span>
<span class="fc" id="L445">            UnitType milkmaid = specification.getUnitType(&quot;model.unit.milkmaid&quot;);</span>
<span class="fc" id="L446">            assertEquals(numberOfUnitTypes + 1, </span>
<span class="fc" id="L447">                specification.getUnitTypeList().size());</span>
<span class="pc" id="L448">        } catch (Exception e) {</span>
<span class="nc" id="L449">            fail(e.getMessage());</span>
        }
<span class="fc" id="L451">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span>src (May 7, 2016 6:04:12 PM)</div></body></html>