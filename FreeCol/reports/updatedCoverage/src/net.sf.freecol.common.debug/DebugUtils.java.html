<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>DebugUtils.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">net.sf.freecol.tools (2) (May 15, 2016 11:18:55 PM)</a> &gt; <a href="../../index.html" class="el_group">FreeCol</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.source.html" class="el_package">net.sf.freecol.common.debug</a> &gt; <span class="el_source">DebugUtils.java</span></div><h1>DebugUtils.java</h1><pre class="source lang-java linenums">/**
 *  Copyright (C) 2002-2016   The FreeCol Team
 *
 *  This file is part of FreeCol.
 *
 *  FreeCol is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  FreeCol is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with FreeCol.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */

package net.sf.freecol.common.debug;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.Map.Entry;
import java.util.logging.Logger;
import java.util.stream.Collectors;

import javax.swing.JMenu;
import javax.swing.JMenuItem;
import javax.swing.event.ChangeEvent;

import net.sf.freecol.client.FreeColClient;
import net.sf.freecol.client.gui.GUI;
import net.sf.freecol.client.gui.ChoiceItem;
import net.sf.freecol.common.i18n.Messages;
import net.sf.freecol.common.io.FreeColXMLWriter.WriteScope;
import net.sf.freecol.common.model.AbstractGoods;
import net.sf.freecol.common.model.Building;
import net.sf.freecol.common.model.BuildingType;
import net.sf.freecol.common.model.Colony;
import net.sf.freecol.common.model.Disaster;
import net.sf.freecol.common.model.Europe;
import net.sf.freecol.common.model.FoundingFather;
import net.sf.freecol.common.model.Game;
import net.sf.freecol.common.model.GameOptions;
import net.sf.freecol.common.model.Goods;
import net.sf.freecol.common.model.GoodsContainer;
import net.sf.freecol.common.model.GoodsType;
import net.sf.freecol.common.model.IndianSettlement;
import net.sf.freecol.common.model.Location;
import net.sf.freecol.common.model.LostCityRumour.RumourType;
import net.sf.freecol.common.model.Map;
import net.sf.freecol.common.model.Monarch.MonarchAction;
import net.sf.freecol.common.model.Player;
import net.sf.freecol.common.model.Role;
import net.sf.freecol.common.model.Settlement;
import net.sf.freecol.common.model.Specification;
import net.sf.freecol.common.model.StringTemplate;
import net.sf.freecol.common.model.Tension;
import net.sf.freecol.common.model.Tile;
import net.sf.freecol.common.model.Unit;
import net.sf.freecol.common.model.UnitType;
import net.sf.freecol.common.option.BooleanOption;
import net.sf.freecol.common.util.LogBuilder;
import static net.sf.freecol.common.util.CollectionUtils.*;
import net.sf.freecol.common.util.RandomChoice;
import static net.sf.freecol.common.util.StringUtils.*;

import net.sf.freecol.server.FreeColServer;
import net.sf.freecol.server.ai.AIColony;
import net.sf.freecol.server.ai.AIMain;
import net.sf.freecol.server.ai.AIPlayer;
import net.sf.freecol.server.ai.AIUnit;
import net.sf.freecol.server.ai.mission.Mission;
import net.sf.freecol.server.ai.mission.TransportMission;
import net.sf.freecol.server.model.ServerBuilding;
import net.sf.freecol.server.model.ServerColony;
import net.sf.freecol.server.model.ServerPlayer;
import net.sf.freecol.server.model.ServerUnit;


/**
 * Utilities for in game debug support.
 *
 * Several client GUI features have optional debug routines.  These
 * routines are typically quite special in that they need to intrusive
 * things with the server, and do not have much in common with the
 * client code while still sometimes needing user interaction.  They
 * also have considerable similarity amongst themselves.  So they have
 * been collected here.
 *
 * The client GUI features that are the source of these routines are:
 *   - The colony panel
 *   - The debug menu
 *   - The tile popup menu
 */
<span class="nc" id="L100">public class DebugUtils {</span>

<span class="nc" id="L102">    private static final Logger logger = Logger.getLogger(DebugUtils.class.getName());</span>


    /**
     * Debug action to add buildings to the user colonies.
     *
     * Called from the debug menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @param buildingTitle A label for the choice dialog.
     */
    public static void addBuildings(final FreeColClient freeColClient,
                                    String buildingTitle) {
<span class="nc" id="L115">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L116">        final Game game = freeColClient.getGame();</span>
<span class="nc" id="L117">        final Specification spec = game.getSpecification();</span>
<span class="nc" id="L118">        final GUI gui = freeColClient.getGUI();</span>
<span class="nc" id="L119">        final Player player = freeColClient.getMyPlayer();</span>

<span class="nc" id="L121">        BuildingType buildingType = gui.getChoice(null, buildingTitle,</span>
<span class="nc" id="L122">            &quot;cancel&quot;,</span>
<span class="nc" id="L123">            toSortedList(map(spec.getBuildingTypeList(), (BuildingType bt) -&gt;</span>
<span class="nc" id="L124">                    new ChoiceItem&lt;BuildingType&gt;(Messages.getName(bt), bt))));</span>
<span class="nc bnc" id="L125" title="All 2 branches missed.">        if (buildingType == null) return;</span>

<span class="nc" id="L127">        final Game sGame = server.getGame();</span>
<span class="nc" id="L128">        final BuildingType sBuildingType = server.getSpecification()</span>
<span class="nc" id="L129">            .getBuildingType(buildingType.getId());</span>
<span class="nc" id="L130">        final Player sPlayer = sGame.getFreeColGameObject(player.getId(),</span>
<span class="nc" id="L131">                                                          Player.class);</span>
<span class="nc" id="L132">        List&lt;String&gt; results = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L133">        int fails = 0;</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">        for (Colony sColony : sPlayer.getColonies()) {</span>
<span class="nc" id="L135">            Colony.NoBuildReason reason</span>
<span class="nc" id="L136">                = sColony.getNoBuildReason(sBuildingType, null);</span>
<span class="nc" id="L137">            results.add(sColony.getName() + &quot;: &quot; + reason);</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">            if (reason == Colony.NoBuildReason.NONE) {</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">                if (sBuildingType.isDefenceType()) {</span>
<span class="nc" id="L140">                    sColony.getTile().cacheUnseen();//+til</span>
                }
<span class="nc" id="L142">                Building sBuilding = new ServerBuilding(sGame, sColony,</span>
<span class="nc" id="L143">                                                        sBuildingType);</span>
<span class="nc" id="L144">                sColony.addBuilding(sBuilding);//-til</span>
<span class="nc" id="L145">            } else {</span>
<span class="nc" id="L146">                fails++;</span>
            }
        }
<span class="nc" id="L149">        gui.showInformationMessage(join(&quot;, &quot;, results));</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">        if (fails &lt; sPlayer.getSettlements().size()) {</span>
            // Brutally resynchronize
<span class="nc" id="L152">            freeColClient.getConnectController().reconnect();</span>
        }
<span class="nc" id="L154">    }</span>

    /**
     * Debug action to add a founding father.
     *
     * Called from the debug menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @param fatherTitle A label for the choice dialog.
     */
    public static void addFathers(final FreeColClient freeColClient,
                                  String fatherTitle) {
<span class="nc" id="L166">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L167">        final GUI gui = freeColClient.getGUI();</span>
<span class="nc" id="L168">        final Player player = freeColClient.getMyPlayer();</span>
<span class="nc" id="L169">        final Game sGame = server.getGame();</span>
<span class="nc" id="L170">        final Specification sSpec = sGame.getSpecification();</span>
<span class="nc" id="L171">        final Player sPlayer = sGame.getFreeColGameObject(player.getId(),</span>
<span class="nc" id="L172">                                                          Player.class);</span>

<span class="nc" id="L174">        FoundingFather father = gui.getChoice(null, fatherTitle,</span>
<span class="nc" id="L175">            &quot;cancel&quot;,</span>
<span class="nc" id="L176">            transformAndSort(sSpec.getFoundingFathers(),</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">                f -&gt; !sPlayer.hasFather(f),</span>
<span class="nc" id="L178">                (FoundingFather f) -&gt;</span>
<span class="nc" id="L179">                    new ChoiceItem&lt;FoundingFather&gt;(Messages.getName(f), f),</span>
<span class="nc" id="L180">                Collectors.toList()));</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">        if (father != null) {</span>
<span class="nc" id="L182">            server.getInGameController()</span>
<span class="nc" id="L183">                .addFoundingFather((ServerPlayer)sPlayer, father);</span>
        }
<span class="nc" id="L185">    }</span>

    /**
     * Debug action to add gold.
     *
     * Called from the debug menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     */
    public static void addGold(final FreeColClient freeColClient) {
<span class="nc" id="L195">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L196">        final GUI gui = freeColClient.getGUI();</span>
<span class="nc" id="L197">        final Player player = freeColClient.getMyPlayer();</span>
<span class="nc" id="L198">        final Game sGame = server.getGame();</span>
<span class="nc" id="L199">        final Player sPlayer = sGame.getFreeColGameObject(player.getId(),</span>
<span class="nc" id="L200">                                                          Player.class);</span>

<span class="nc" id="L202">        String response = gui.getInput(null,</span>
<span class="nc" id="L203">            StringTemplate.template(&quot;prompt.selectGold&quot;),</span>
<span class="nc" id="L204">            Integer.toString(1000), &quot;ok&quot;, &quot;cancel&quot;);</span>
<span class="nc bnc" id="L205" title="All 4 branches missed.">        if (response == null || response.isEmpty()) return;</span>
        int gold;
        try {
<span class="nc" id="L208">            gold = Integer.parseInt(response);</span>
<span class="nc" id="L209">        } catch (NumberFormatException x) {</span>
<span class="nc" id="L210">            return;</span>
        }
<span class="nc" id="L212">        player.modifyGold(gold);</span>
<span class="nc" id="L213">        sPlayer.modifyGold(gold);</span>
<span class="nc" id="L214">    }</span>

    /**
     * Debug action to add immigration.
     *
     * Called from the debug menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     */
    public static void addImmigration(final FreeColClient freeColClient) {
<span class="nc" id="L224">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L225">        final GUI gui = freeColClient.getGUI();</span>
<span class="nc" id="L226">        final Player player = freeColClient.getMyPlayer();</span>
<span class="nc" id="L227">        final Game sGame = server.getGame();</span>
<span class="nc" id="L228">        final Player sPlayer = sGame.getFreeColGameObject(player.getId(),</span>
<span class="nc" id="L229">                                                          Player.class);</span>

<span class="nc" id="L231">        String response = gui.getInput(null,</span>
<span class="nc" id="L232">            StringTemplate.template(&quot;prompt.selectImmigration&quot;),</span>
<span class="nc" id="L233">            Integer.toString(100), &quot;ok&quot;, &quot;cancel&quot;);</span>
<span class="nc bnc" id="L234" title="All 4 branches missed.">        if (response == null || response.isEmpty()) return;</span>
        int crosses;
        try {
<span class="nc" id="L237">            crosses = Integer.parseInt(response);</span>
<span class="nc" id="L238">        } catch (NumberFormatException x) {</span>
<span class="nc" id="L239">            return;</span>
        }
<span class="nc" id="L241">        player.modifyImmigration(crosses);</span>
<span class="nc" id="L242">        sPlayer.modifyImmigration(crosses);</span>
<span class="nc" id="L243">    }</span>

    /**
     * Debug action to add liberty to the player colonies.
     *
     * Called from the debug menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     */
    public static void addLiberty(final FreeColClient freeColClient) {
<span class="nc" id="L253">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L254">        final GUI gui = freeColClient.getGUI();</span>
<span class="nc" id="L255">        final Player player = freeColClient.getMyPlayer();</span>
<span class="nc" id="L256">        final Game sGame = server.getGame();</span>

<span class="nc" id="L258">        String response = gui.getInput(null,</span>
<span class="nc" id="L259">            StringTemplate.template(&quot;prompt.selectLiberty&quot;),</span>
<span class="nc" id="L260">            Integer.toString(100), &quot;ok&quot;, &quot;cancel&quot;);</span>
<span class="nc bnc" id="L261" title="All 4 branches missed.">        if (response == null || response.isEmpty()) return;</span>
        int liberty;
        try {
<span class="nc" id="L264">            liberty = Integer.parseInt(response);</span>
<span class="nc" id="L265">        } catch (NumberFormatException x) {</span>
<span class="nc" id="L266">            return;</span>
        }
<span class="nc bnc" id="L268" title="All 2 branches missed.">        for (Colony c : player.getColonies()) {</span>
<span class="nc" id="L269">            c.addLiberty(liberty);</span>
<span class="nc" id="L270">            sGame.getFreeColGameObject(c.getId(), Colony.class)</span>
<span class="nc" id="L271">                .addLiberty(liberty);</span>
        }
<span class="nc" id="L273">    }</span>

    /**
     * Adds a change listener to a menu (the debug menu in fact),
     * that changes the label on a menu item when the skip status changes.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @param menu The menu to add the change listener to.
     * @param item The menu item whose label should change.
     */
    public static void addSkipChangeListener(final FreeColClient freeColClient,
                                             JMenu menu, final JMenuItem item) {
<span class="nc" id="L285">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc bnc" id="L286" title="All 2 branches missed.">        if (server == null) return;</span>

<span class="nc" id="L288">        menu.addChangeListener((ChangeEvent e) -&gt; {</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">                boolean skipping = server.getInGameController()</span>
<span class="nc" id="L290">                    .getSkippedTurns() &gt; 0;</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">                item.setText(Messages.message((skipping)</span>
<span class="nc" id="L292">                        ? &quot;menuBar.debug.stopSkippingTurns&quot;</span>
<span class="nc" id="L293">                        : &quot;menuBar.debug.skipTurns&quot;));</span>
<span class="nc" id="L294">            });</span>
<span class="nc" id="L295">    }</span>

    /**
     * Debug action to add a new unit to a tile.
     *
     * Called from tile popup menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @param tile The &lt;code&gt;Tile&lt;/code&gt; to add to.
     */
    public static void addNewUnitToTile(final FreeColClient freeColClient,
                                        Tile tile) {
<span class="nc" id="L307">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L308">        final Game sGame = server.getGame();</span>
<span class="nc" id="L309">        final Specification sSpec = sGame.getSpecification();</span>
<span class="nc" id="L310">        final Player player = freeColClient.getMyPlayer();</span>
<span class="nc" id="L311">        final Player sPlayer = sGame.getFreeColGameObject(player.getId(),</span>
<span class="nc" id="L312">                                                          Player.class);</span>
<span class="nc" id="L313">        final Tile sTile = sGame.getFreeColGameObject(tile.getId(), Tile.class);</span>
<span class="nc" id="L314">        final GUI gui = freeColClient.getGUI();</span>

<span class="nc" id="L316">        UnitType unitChoice = gui.getChoice(null,</span>
<span class="nc" id="L317">            StringTemplate.template(&quot;prompt.selectUnitType&quot;), &quot;cancel&quot;,</span>
<span class="nc" id="L318">            toSortedList(map(sSpec.getUnitTypeList(), (UnitType ut) -&gt;</span>
<span class="nc" id="L319">                    new ChoiceItem&lt;UnitType&gt;(Messages.getName(ut), ut))));</span>
<span class="nc bnc" id="L320" title="All 2 branches missed.">        if (unitChoice == null) return;</span>

<span class="nc" id="L322">        Unit carrier = null, sCarrier = null;</span>
<span class="nc bnc" id="L323" title="All 4 branches missed.">        if (!sTile.isLand() &amp;&amp; !unitChoice.isNaval()) {</span>
<span class="nc bnc" id="L324" title="All 2 branches missed.">            sCarrier = find(sTile.getUnitList(), u -&gt; u.isNaval()</span>
<span class="nc bnc" id="L325" title="All 2 branches missed.">                &amp;&amp; u.getSpaceLeft() &gt;= unitChoice.getSpaceTaken());</span>
        }
<span class="nc bnc" id="L327" title="All 2 branches missed.">        Location loc = (sCarrier != null) ? sCarrier : sTile;</span>
<span class="nc" id="L328">        ServerUnit sUnit = new ServerUnit(sGame, loc, sPlayer,</span>
<span class="nc" id="L329">                                          unitChoice);//-vis(sPlayer)</span>
<span class="nc" id="L330">        ((ServerPlayer)sPlayer).exploreForUnit(sUnit);</span>
<span class="nc" id="L331">        sUnit.setMovesLeft(sUnit.getInitialMovesLeft());</span>
<span class="nc" id="L332">        sPlayer.invalidateCanSeeTiles();//+vis(sPlayer)</span>

<span class="nc" id="L334">        freeColClient.getConnectController().reconnect();</span>
        // Note &quot;game&quot; is no longer valid after reconnect.
<span class="nc" id="L336">        Unit unit = freeColClient.getGame()</span>
<span class="nc" id="L337">            .getFreeColGameObject(sUnit.getId(), Unit.class);</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">        if (unit != null) {</span>
<span class="nc" id="L339">            gui.setActiveUnit(unit);</span>
<span class="nc" id="L340">            gui.refresh();</span>
<span class="nc" id="L341">            gui.resetMenuBar();</span>
        }
<span class="nc" id="L343">    }</span>

    /**
     * Debug action to add goods to a unit.
     *
     * Called from tile popup menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @param unit The &lt;code&gt;Unit&lt;/code&gt; to add to.
     */
    public static void addUnitGoods(final FreeColClient freeColClient,
                                    final Unit unit) {
<span class="nc" id="L355">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L356">        final Game sGame = server.getGame();</span>
<span class="nc" id="L357">        final Specification sSpec = sGame.getSpecification();</span>
<span class="nc" id="L358">        final GUI gui = freeColClient.getGUI();</span>

<span class="nc" id="L360">        GoodsType goodsType = gui.getChoice(null,</span>
<span class="nc" id="L361">            StringTemplate.template(&quot;prompt.selectGoodsType&quot;),</span>
<span class="nc" id="L362">            &quot;cancel&quot;,</span>
<span class="nc" id="L363">            transformAndSort(sSpec.getGoodsTypeList(),</span>
<span class="nc bnc" id="L364" title="All 4 branches missed.">                gt -&gt; !gt.isFoodType() || gt == sSpec.getPrimaryFoodType(),</span>
<span class="nc" id="L365">                (GoodsType gt) -&gt;</span>
<span class="nc" id="L366">                    new ChoiceItem&lt;GoodsType&gt;(Messages.getName(gt), gt),</span>
<span class="nc" id="L367">                Collectors.toList()));</span>
<span class="nc bnc" id="L368" title="All 2 branches missed.">        if (goodsType == null) return;</span>

<span class="nc" id="L370">        String amount = gui.getInput(null,</span>
<span class="nc" id="L371">            StringTemplate.template(&quot;prompt.selectGoodsAmount&quot;),</span>
<span class="nc" id="L372">            &quot;20&quot;, &quot;ok&quot;, &quot;cancel&quot;);</span>
<span class="nc bnc" id="L373" title="All 2 branches missed.">        if (amount == null) return;</span>

        int a;
        try {
<span class="nc" id="L377">            a = Integer.parseInt(amount);</span>
<span class="nc" id="L378">        } catch (NumberFormatException nfe) {</span>
<span class="nc" id="L379">            return;</span>
        }
<span class="nc" id="L381">        GoodsType sGoodsType = sSpec.getGoodsType(goodsType.getId());</span>
<span class="nc" id="L382">        GoodsContainer ugc = unit.getGoodsContainer();</span>
<span class="nc" id="L383">        GoodsContainer sgc = sGame.getFreeColGameObject(ugc.getId(),</span>
<span class="nc" id="L384">                                                        GoodsContainer.class);</span>
<span class="nc" id="L385">        ugc.setAmount(goodsType, a);</span>
<span class="nc" id="L386">        sgc.setAmount(sGoodsType, a);</span>
<span class="nc" id="L387">    }</span>

    /**
     * Debug action to apply a disaster to a colony.
     *
     * Called from tile popup menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @param colony The &lt;code&gt;Colony&lt;/code&gt; to apply a disaster to.
     */
    public static void applyDisaster(final FreeColClient freeColClient,
                                     final Colony colony) {
<span class="nc" id="L399">        final GUI gui = freeColClient.getGUI();</span>
<span class="nc" id="L400">        List&lt;RandomChoice&lt;Disaster&gt;&gt; disasters = colony.getDisasters();</span>
<span class="nc bnc" id="L401" title="All 2 branches missed.">        if (disasters.isEmpty()) {</span>
<span class="nc" id="L402">            gui.showErrorMessage(StringTemplate</span>
<span class="nc" id="L403">                .template(&quot;error.disasterNotAvailable&quot;)</span>
<span class="nc" id="L404">                .addName(&quot;%colony%&quot;, colony.getName()));</span>
<span class="nc" id="L405">            return;</span>
        }
<span class="nc" id="L407">        Disaster disaster = gui.getChoice(null,</span>
<span class="nc" id="L408">            StringTemplate.template(&quot;prompt.selectDisaster&quot;), &quot;cancel&quot;,</span>
<span class="nc" id="L409">            toSortedList(map(disasters, (RandomChoice&lt;Disaster&gt; rc) -&gt;</span>
<span class="nc" id="L410">                    new ChoiceItem&lt;Disaster&gt;(Messages.getName(rc.getObject())</span>
<span class="nc" id="L411">                        + &quot; &quot; + Integer.toString(rc.getProbability()),</span>
<span class="nc" id="L412">                        rc.getObject()))));</span>
<span class="nc bnc" id="L413" title="All 2 branches missed.">        if (disaster == null) return;</span>

<span class="nc" id="L415">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L416">        final Game sGame = server.getGame();</span>
<span class="nc" id="L417">        final ServerColony sColony = sGame.getFreeColGameObject(colony.getId(),</span>
<span class="nc" id="L418">            ServerColony.class);</span>
<span class="nc" id="L419">        final Disaster sDisaster = sGame.getSpecification()</span>
<span class="nc" id="L420">            .getDisaster(disaster.getId());</span>
<span class="nc bnc" id="L421" title="All 2 branches missed.">        if (server.getInGameController().debugApplyDisaster(sColony, sDisaster)</span>
            &lt;= 0) {
<span class="nc" id="L423">            gui.showErrorMessage(StringTemplate</span>
<span class="nc" id="L424">                .template(&quot;error.disasterAvoided&quot;)</span>
<span class="nc" id="L425">                .addName(&quot;%colony%&quot;, colony.getName())</span>
<span class="nc" id="L426">                .addNamed(&quot;%disaster%&quot;, disaster));</span>
        }
<span class="nc" id="L428">        freeColClient.getInGameController().nextModelMessage();</span>
<span class="nc" id="L429">    }</span>

    /**
     * Debug action to change ownership of a colony.
     *
     * Called from tile popup menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @param colony The &lt;code&gt;Colony&lt;/code&gt; to take ownership of.
     */
    public static void changeOwnership(final FreeColClient freeColClient,
                                       final Colony colony) {
<span class="nc" id="L441">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L442">        final Game sGame = server.getGame();</span>
<span class="nc" id="L443">        final ServerColony sColony = sGame.getFreeColGameObject(colony.getId(),</span>
<span class="nc" id="L444">            ServerColony.class);</span>
<span class="nc" id="L445">        final GUI gui = freeColClient.getGUI();</span>
<span class="nc" id="L446">        final Game game = freeColClient.getGame();</span>

<span class="nc" id="L448">        Player player = gui.getChoice(null,</span>
<span class="nc" id="L449">            StringTemplate.template(&quot;prompt.selectOwner&quot;), &quot;cancel&quot;,</span>
<span class="nc" id="L450">            toSortedList(map(game.getLiveEuropeanPlayers(colony.getOwner()),</span>
<span class="nc" id="L451">                    (Player p) -&gt; new ChoiceItem&lt;Player&gt;(Messages.message(p.getCountryLabel()), p))));</span>
<span class="nc bnc" id="L452" title="All 2 branches missed.">        if (player == null) return;</span>

<span class="nc" id="L454">        ServerPlayer sPlayer = sGame.getFreeColGameObject(player.getId(),</span>
<span class="nc" id="L455">                                                          ServerPlayer.class);</span>
<span class="nc" id="L456">        server.getInGameController().debugChangeOwner(sColony, sPlayer);</span>

<span class="nc" id="L458">        Player myPlayer = freeColClient.getMyPlayer();</span>
<span class="nc bnc" id="L459" title="All 2 branches missed.">        if (gui.getActiveUnit() != null</span>
<span class="nc bnc" id="L460" title="All 2 branches missed.">            &amp;&amp; gui.getActiveUnit().getOwner() != myPlayer) {</span>
<span class="nc" id="L461">            freeColClient.getInGameController().nextActiveUnit();</span>
        }
<span class="nc" id="L463">        gui.refresh();</span>
<span class="nc" id="L464">        gui.resetMenuBar();</span>
<span class="nc" id="L465">    }</span>

    /**
     * Debug action to change ownership of a unit.
     *
     * Called from tile popup menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @param unit The &lt;code&gt;Unit&lt;/code&gt; to take ownership of.
     */
    public static void changeOwnership(final FreeColClient freeColClient,
                                       final Unit unit) {
<span class="nc" id="L477">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L478">        final GUI gui = freeColClient.getGUI();</span>
<span class="nc" id="L479">        final Game game = unit.getGame();</span>

<span class="nc" id="L481">        Player player = gui.getChoice(null,</span>
<span class="nc" id="L482">            StringTemplate.template(&quot;prompt.selectOwner&quot;), &quot;cancel&quot;,</span>
<span class="nc" id="L483">            transformAndSort(game.getLivePlayers(null),</span>
<span class="nc" id="L484">                p -&gt; unit.getType().isAvailableTo(p),</span>
<span class="nc" id="L485">                (Player p) -&gt;</span>
<span class="nc" id="L486">                    new ChoiceItem&lt;Player&gt;(Messages.message(p.getCountryLabel()), p),</span>
<span class="nc" id="L487">                Collectors.toList()));</span>
<span class="nc bnc" id="L488" title="All 4 branches missed.">        if (player == null || unit.getOwner() == player) return;</span>

<span class="nc" id="L490">        final Game sGame = server.getGame();</span>
<span class="nc" id="L491">        ServerUnit sUnit = sGame.getFreeColGameObject(unit.getId(), </span>
<span class="nc" id="L492">                                                      ServerUnit.class);</span>
<span class="nc" id="L493">        ServerPlayer sPlayer = sGame.getFreeColGameObject(player.getId(),</span>
<span class="nc" id="L494">                                                          ServerPlayer.class);</span>
<span class="nc" id="L495">        server.getInGameController().debugChangeOwner(sUnit, sPlayer);</span>

<span class="nc" id="L497">        Player myPlayer = freeColClient.getMyPlayer();</span>
<span class="nc bnc" id="L498" title="All 2 branches missed.">        if (unit.getOwner() == myPlayer) {</span>
<span class="nc" id="L499">            gui.setActiveUnit(unit);</span>
<span class="nc" id="L500">        } else {</span>
<span class="nc" id="L501">            freeColClient.getInGameController().nextActiveUnit();</span>
        }
<span class="nc" id="L503">        gui.refresh();</span>
<span class="nc" id="L504">        gui.resetMenuBar();</span>
<span class="nc" id="L505">    }</span>

    /**
     * Debug action to change the roles of a unit.
     *
     * Called from tile popup menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @param unit The &lt;code&gt;Unit&lt;/code&gt; to change the role of.
     */
    public static void changeRole(final FreeColClient freeColClient,
                                  final Unit unit) {
<span class="nc" id="L517">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L518">        final Game sGame = server.getGame();</span>
<span class="nc" id="L519">        final Unit sUnit = sGame.getFreeColGameObject(unit.getId(), Unit.class);</span>
<span class="nc" id="L520">        final GUI gui = freeColClient.getGUI();</span>

<span class="nc" id="L522">        Role roleChoice = gui.getChoice(null,</span>
<span class="nc" id="L523">            StringTemplate.template(&quot;prompt.selectRole&quot;), &quot;cancel&quot;,</span>
<span class="nc" id="L524">            toSortedList(map(sGame.getSpecification().getRoles(),</span>
<span class="nc" id="L525">                    (Role r) -&gt; new ChoiceItem&lt;Role&gt;(r.getId(), r))));</span>
<span class="nc bnc" id="L526" title="All 2 branches missed.">        if (roleChoice == null) return;</span>

<span class="nc" id="L528">        sUnit.changeRole(roleChoice, roleChoice.getMaximumCount());</span>
<span class="nc" id="L529">        freeColClient.getConnectController().reconnect();</span>
<span class="nc" id="L530">    }</span>

    /**
     * Debug action to check for client-server desynchronization.
     *
     * Called from the debug menu and client controller.
     * TODO: This is still fairly new and messy.  Defer i18n for a while.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @return True if desynchronization found.
     */
    public static boolean checkDesyncAction(final FreeColClient freeColClient) {
<span class="nc" id="L542">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L543">        final Game game = freeColClient.getGame();</span>
<span class="nc" id="L544">        final Map map = game.getMap();</span>
<span class="nc" id="L545">        final Player player = freeColClient.getMyPlayer();</span>
<span class="nc" id="L546">        final Game sGame = server.getGame();</span>
<span class="nc" id="L547">        final Map sMap = sGame.getMap();</span>
<span class="nc" id="L548">        final ServerPlayer sPlayer = sGame.getFreeColGameObject(player.getId(),</span>
<span class="nc" id="L549">                                                                ServerPlayer.class);</span>

<span class="nc" id="L551">        boolean problemDetected = false;</span>
<span class="nc" id="L552">        LogBuilder lb = new LogBuilder(256);</span>
<span class="nc" id="L553">        lb.add(&quot;Desynchronization detected\n&quot;);</span>
<span class="nc bnc" id="L554" title="All 2 branches missed.">        for (Tile t : sMap.getAllTiles()) {</span>
<span class="nc bnc" id="L555" title="All 2 branches missed.">            if (!sPlayer.canSee(t)) continue;</span>
<span class="nc bnc" id="L556" title="All 2 branches missed.">            for (Unit u : t.getUnitList()) {</span>
<span class="nc bnc" id="L557" title="All 2 branches missed.">                if (!sPlayer.owns(u)</span>
<span class="nc bnc" id="L558" title="All 4 branches missed.">                    &amp;&amp; (t.hasSettlement() || u.isOnCarrier())) continue;</span>
<span class="nc bnc" id="L559" title="All 2 branches missed.">                if (game.getFreeColGameObject(u.getId(), Unit.class) == null) {</span>
<span class="nc" id="L560">                    lb.add(&quot;Unit missing on client-side.\n&quot;, &quot;  Server: &quot;,</span>
<span class="nc" id="L561">                           u.getDescription(Unit.UnitLabelType.NATIONAL),</span>
<span class="nc" id="L562">                           &quot;(&quot;, u.getId(), &quot;) from: &quot;, </span>
<span class="nc" id="L563">                           u.getLocation().getId(), &quot;.\n&quot;);</span>
                    try {
<span class="nc" id="L565">                        lb.add(&quot;  Client: &quot;, map.getTile(u.getTile().getX(),</span>
<span class="nc" id="L566">                               u.getTile().getY()).getFirstUnit().getId(),</span>
<span class="nc" id="L567">                               &quot;\n&quot;);</span>
<span class="nc" id="L568">                    } catch (NullPointerException npe) {}</span>
<span class="nc" id="L569">                    problemDetected = true;</span>
<span class="nc" id="L570">                } else {</span>
<span class="nc" id="L571">                    Unit cUnit = game.getFreeColGameObject(u.getId(),</span>
<span class="nc" id="L572">                                                           Unit.class);</span>
<span class="nc bnc" id="L573" title="All 2 branches missed.">                    if (cUnit.hasTile()</span>
<span class="nc bnc" id="L574" title="All 2 branches missed.">                        &amp;&amp; !cUnit.getTile().getId().equals(u.getTile().getId())) {</span>
<span class="nc" id="L575">                        lb.add(&quot;Unit located on different tiles.\n&quot;,</span>
<span class="nc" id="L576">                            &quot;  Server: &quot;, u.getDescription(Unit.UnitLabelType.NATIONAL),</span>
<span class="nc" id="L577">                            &quot;(&quot;, u.getId(), &quot;) from: &quot;,</span>
<span class="nc" id="L578">                            u.getLocation().getId(), &quot;\n&quot;,</span>
<span class="nc" id="L579">                            &quot;  Client: &quot;, cUnit.getDescription(Unit.UnitLabelType.NATIONAL),</span>
<span class="nc" id="L580">                            &quot;(&quot;, cUnit.getId(), &quot;) at: &quot;,</span>
<span class="nc" id="L581">                            cUnit.getLocation().getId(), &quot;\n&quot;);</span>
<span class="nc" id="L582">                        problemDetected = true;</span>
                    }
                }
            }
<span class="nc" id="L586">            Tile ct = game.getFreeColGameObject(t.getId(), Tile.class);</span>
<span class="nc" id="L587">            Settlement sSettlement = t.getSettlement();</span>
<span class="nc" id="L588">            Settlement cSettlement = ct.getSettlement();</span>
<span class="nc bnc" id="L589" title="All 2 branches missed.">            if (sSettlement == null) {</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">                if (cSettlement == null) {</span>
                    ;// OK
<span class="nc" id="L592">                } else {</span>
<span class="nc" id="L593">                    lb.add(&quot;Settlement still present in client: &quot;, cSettlement);</span>
<span class="nc" id="L594">                    problemDetected = true;</span>
                }
<span class="nc" id="L596">            } else {</span>
<span class="nc bnc" id="L597" title="All 2 branches missed.">                if (cSettlement == null) {</span>
<span class="nc" id="L598">                    lb.add(&quot;Settlement not present in client: &quot;, sSettlement);</span>
<span class="nc" id="L599">                    problemDetected = true;</span>
<span class="nc bnc" id="L600" title="All 2 branches missed.">                } else if (sSettlement.getId().equals(cSettlement.getId())) {</span>
                    ;// OK
<span class="nc" id="L602">                } else {</span>
<span class="nc" id="L603">                    lb.add(&quot;Settlements differ.\n  Server: &quot;,</span>
<span class="nc" id="L604">                        sSettlement.toString(), &quot;\n  Client: &quot;, </span>
<span class="nc" id="L605">                        cSettlement.toString(), &quot;\n&quot;);</span>
                }
            }
        }

<span class="nc" id="L610">        boolean goodsProblemDetected = false;</span>
<span class="nc bnc" id="L611" title="All 2 branches missed.">        for (GoodsType sg : sGame.getSpecification().getGoodsTypeList()) {</span>
<span class="nc" id="L612">            int sPrice = sPlayer.getMarket().getBidPrice(sg, 1);</span>
<span class="nc" id="L613">            GoodsType cg = game.getSpecification().getGoodsType(sg.getId());</span>
<span class="nc" id="L614">            int cPrice = player.getMarket().getBidPrice(cg, 1);</span>
<span class="nc bnc" id="L615" title="All 2 branches missed.">            if (sPrice != cPrice) {</span>
<span class="nc" id="L616">                lb.add(&quot;Goods prices for &quot;, sg, &quot; differ.\n&quot;);</span>
<span class="nc" id="L617">                goodsProblemDetected = true;</span>
            }
        }
<span class="nc bnc" id="L620" title="All 2 branches missed.">        if (goodsProblemDetected) {</span>
<span class="nc" id="L621">            lb.add(&quot;  Server:\n&quot;, sPlayer.getMarket(), &quot;\n&quot;,</span>
<span class="nc" id="L622">                &quot;  Client:\n&quot;, player.getMarket(), &quot;\n&quot;);</span>
<span class="nc" id="L623">            problemDetected = true;</span>
        }

<span class="nc bnc" id="L626" title="All 2 branches missed.">        if (problemDetected) {</span>
<span class="nc" id="L627">            lb.shrink(&quot;\n&quot;);</span>
<span class="nc" id="L628">            String err = lb.toString();</span>
<span class="nc" id="L629">            freeColClient.getGUI().showInformationMessage(err);</span>
<span class="nc" id="L630">            logger.severe(err);</span>
        }
<span class="nc" id="L632">        return problemDetected;</span>
    }

    /**
     * Debug action to display an AI colony plan.
     *
     * Called from tile popup menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @param colony The &lt;code&gt;Colony&lt;/code&gt; to summarize.
     */
    public static void displayColonyPlan(final FreeColClient freeColClient,
                                         final Colony colony) {
<span class="nc" id="L645">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L646">        final AIMain aiMain = server.getAIMain();</span>
<span class="nc" id="L647">        final AIColony aiColony = aiMain.getAIColony(colony);</span>
<span class="nc bnc" id="L648" title="All 2 branches missed.">        if (aiColony == null) {</span>
<span class="nc" id="L649">            freeColClient.getGUI().showErrorMessage(StringTemplate</span>
<span class="nc" id="L650">                .template(&quot;error.notAIColony&quot;)</span>
<span class="nc" id="L651">                .addName(&quot;%colony%&quot;, colony.getName()));</span>
<span class="nc" id="L652">        } else {</span>
            // TODO: Missing i18n
<span class="nc" id="L654">            freeColClient.getGUI().showInformationMessage(aiColony.planToString());</span>
        }
<span class="nc" id="L656">    }</span>

    /**
     * Debug action to create a string showing the colony value for
     * a given tile and player.
     *
     * Note: passing the freeColClient is redundant for now, but will
     * be needed if/when we move getColonyValue into the AI.
     *
     * @param tile The colony &lt;code&gt;Tile&lt;/code&gt; to evaluate.
     * @return A string describing the colony value of a tile.
     */
    public static String getColonyValue(Tile tile) {
<span class="nc" id="L669">        Player player = FreeColDebugger.debugDisplayColonyValuePlayer();</span>
<span class="nc bnc" id="L670" title="All 2 branches missed.">        if (player == null) return null;</span>
<span class="nc" id="L671">        int value = player.getColonyValue(tile);</span>
<span class="nc bnc" id="L672" title="All 2 branches missed.">        if (value &lt; 0) {</span>
<span class="nc" id="L673">            return Player.NoValueType.fromValue(value).toString();</span>
        }
<span class="nc" id="L675">        return Integer.toString(value);</span>
    }

    /**
     * Debug action to display Europe.
     *
     * Called from the debug popup menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     */
    public static void displayEurope(final FreeColClient freeColClient) {
<span class="nc" id="L686">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L687">        final Game sGame = server.getGame();</span>
<span class="nc" id="L688">        final AIMain aiMain = server.getAIMain();</span>

<span class="nc" id="L690">        LogBuilder lb = new LogBuilder(256);</span>
<span class="nc" id="L691">        List&lt;Unit&gt; inEurope = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L692">        List&lt;Unit&gt; toEurope = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L693">        List&lt;Unit&gt; toAmerica = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L694">        HashMap&lt;String,List&lt;Unit&gt;&gt; units = new HashMap&lt;&gt;();</span>
<span class="nc bnc" id="L695" title="All 2 branches missed.">        for (Player tp : sGame.getLiveEuropeanPlayers(null)) {</span>
<span class="nc" id="L696">            Player p = sGame.getFreeColGameObject(tp.getId(), Player.class);</span>
<span class="nc bnc" id="L697" title="All 2 branches missed.">            if (p.getEurope() == null) continue;</span>
<span class="nc" id="L698">            inEurope.clear();</span>
<span class="nc" id="L699">            toEurope.clear();</span>
<span class="nc" id="L700">            toAmerica.clear();</span>
<span class="nc" id="L701">            units.clear();</span>
<span class="nc" id="L702">            units.put(Messages.message(&quot;sailingToEurope&quot;), toEurope);</span>
<span class="nc" id="L703">            units.put(Messages.getName(p.getEurope()), inEurope);</span>
<span class="nc" id="L704">            units.put(Messages.message(&quot;sailingToAmerica&quot;), toAmerica);</span>
<span class="nc" id="L705">            lb.add(&quot;\n==&quot;, Messages.message(p.getCountryLabel()), &quot;==\n&quot;);</span>

<span class="nc bnc" id="L707" title="All 2 branches missed.">            for (Unit u : p.getEurope().getUnitList()) {</span>
<span class="nc bnc" id="L708" title="All 2 branches missed.">                if (u.getDestination() instanceof Map) {</span>
<span class="nc" id="L709">                    toAmerica.add(u);</span>
<span class="nc" id="L710">                    continue;</span>
                }
<span class="nc bnc" id="L712" title="All 2 branches missed.">                if (u.getDestination() instanceof Europe) {</span>
<span class="nc" id="L713">                    toEurope.add(u);</span>
<span class="nc" id="L714">                    continue;</span>
                }
<span class="nc" id="L716">                inEurope.add(u);</span>
            }

<span class="nc bnc" id="L719" title="All 2 branches missed.">            for (Entry&lt;String, List&lt;Unit&gt;&gt; entry : units.entrySet()) {</span>
<span class="nc" id="L720">                final String label = entry.getKey();</span>
<span class="nc" id="L721">                final List&lt;Unit&gt; list = entry.getValue();</span>
<span class="nc bnc" id="L722" title="All 2 branches missed.">                if (list.isEmpty()) continue;</span>
<span class="nc" id="L723">                lb.add(&quot;\n-&gt;&quot;, label, &quot;\n&quot;);</span>
<span class="nc bnc" id="L724" title="All 2 branches missed.">                for (Unit u : list) {</span>
<span class="nc" id="L725">                    lb.add(&quot;\n&quot;, u.getDescription(Unit.UnitLabelType.NATIONAL));</span>
<span class="nc bnc" id="L726" title="All 2 branches missed.">                    if (u.isDamaged()) {</span>
<span class="nc" id="L727">                        lb.add(&quot; (&quot;, Messages.message(u.getRepairLabel()),</span>
<span class="nc" id="L728">                            &quot;)&quot;);</span>
<span class="nc" id="L729">                    } else {</span>
<span class="nc" id="L730">                        lb.add(&quot;    &quot;);</span>
<span class="nc" id="L731">                        AIUnit aiu = aiMain.getAIUnit(u);</span>
<span class="nc bnc" id="L732" title="All 2 branches missed.">                        if (!aiu.hasMission()) {</span>
<span class="nc" id="L733">                            lb.add(&quot; (&quot;, Messages.message(&quot;none&quot;), &quot;)&quot;);</span>
<span class="nc" id="L734">                        } else {</span>
<span class="nc" id="L735">                            lb.add(aiu.getMission().toString()</span>
<span class="nc" id="L736">                                .replaceAll(&quot;\n&quot;, &quot;    \n&quot;));</span>
                        }
                    }
                }
<span class="nc" id="L740">                lb.add(&quot;\n&quot;);</span>
            }
<span class="nc" id="L742">            lb.add(&quot;\n-&gt;&quot;, Messages.message(&quot;immigrants&quot;), &quot;\n\n&quot;);</span>
<span class="nc bnc" id="L743" title="All 2 branches missed.">            for (UnitType unitType : p.getEurope().getRecruitables()) {</span>
<span class="nc" id="L744">                lb.add(Messages.getName(unitType), &quot;\n&quot;);</span>
            }
<span class="nc" id="L746">            lb.add(&quot;\n&quot;);</span>
        }
<span class="nc" id="L748">        freeColClient.getGUI().showInformationMessage(lb.toString());</span>
<span class="nc" id="L749">    }</span>

    /**
     * Debug action to display a mission.
     *
     * Called from tile popup menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @param unit The &lt;code&gt;Unit&lt;/code&gt; to display.
     */
    public static void displayMission(final FreeColClient freeColClient,
                                      final Unit unit) {
<span class="nc" id="L761">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L762">        final AIMain aiMain = server.getAIMain();</span>
<span class="nc" id="L763">        final AIUnit aiUnit = aiMain.getAIUnit(unit);</span>
<span class="nc" id="L764">        Mission m = aiUnit.getMission();</span>
<span class="nc bnc" id="L765" title="All 2 branches missed.">        String msg = (m == null) ? Messages.message(&quot;none&quot;)</span>
<span class="nc bnc" id="L766" title="All 2 branches missed.">            : (m instanceof TransportMission) ? ((TransportMission)m).toFullString()</span>
<span class="nc" id="L767">            : m.toString();</span>
<span class="nc" id="L768">        freeColClient.getGUI().showInformationMessage(msg);</span>
<span class="nc" id="L769">    }</span>

    /**
     * Debug action to dump a players units/iterators to stderr.
     *
     * Called from the debug menu.
     * TODO: missing i18n
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     */
    public static void displayUnits(final FreeColClient freeColClient) {
<span class="nc" id="L780">        final Player player = freeColClient.getMyPlayer();</span>
<span class="nc" id="L781">        List&lt;Unit&gt; all = player.getUnits();</span>
<span class="nc" id="L782">        LogBuilder lb = new LogBuilder(256);</span>
<span class="nc" id="L783">        lb.add(&quot;\nActive units:\n&quot;);</span>

<span class="nc" id="L785">        Unit u, first = player.getNextActiveUnit();</span>
<span class="nc bnc" id="L786" title="All 2 branches missed.">        if (first != null) {</span>
<span class="nc" id="L787">            lb.add(first.toString(), &quot;\nat &quot;, first.getLocation(), &quot;\n&quot;);</span>
<span class="nc" id="L788">            all.remove(first);</span>
<span class="nc bnc" id="L789" title="All 2 branches missed.">            while (player.hasNextActiveUnit()</span>
<span class="nc bnc" id="L790" title="All 2 branches missed.">                &amp;&amp; (u = player.getNextActiveUnit()) != first) {</span>
<span class="nc" id="L791">                lb.add(u, &quot;\nat &quot;, u.getLocation(), &quot;\n&quot;);</span>
<span class="nc" id="L792">                all.remove(u);</span>
            }
        }
<span class="nc" id="L795">        lb.add(&quot;Going-to units:\n&quot;);</span>
<span class="nc" id="L796">        first = player.getNextGoingToUnit();</span>
<span class="nc bnc" id="L797" title="All 2 branches missed.">        if (first != null) {</span>
<span class="nc" id="L798">            all.remove(first);</span>
<span class="nc" id="L799">            lb.add(first, &quot;\nat &quot;, first.getLocation(), &quot;\n&quot;);</span>
<span class="nc bnc" id="L800" title="All 2 branches missed.">            while (player.hasNextGoingToUnit()</span>
<span class="nc bnc" id="L801" title="All 2 branches missed.">                &amp;&amp; (u = player.getNextGoingToUnit()) != first) {</span>
<span class="nc" id="L802">                lb.add(u, &quot;\nat &quot;, u.getLocation(), &quot;\n&quot;);</span>
<span class="nc" id="L803">                all.remove(u);</span>
            }
        }
<span class="nc" id="L806">        lb.add(&quot;Remaining units:\n&quot;);</span>
<span class="nc bnc" id="L807" title="All 2 branches missed.">        while (!all.isEmpty()) {</span>
<span class="nc" id="L808">            u = all.remove(0);</span>
<span class="nc" id="L809">            lb.add(u, &quot;\nat &quot;, u.getLocation(), &quot;\n&quot;);</span>
        }

<span class="nc" id="L812">        freeColClient.getGUI().showInformationMessage(lb.toString());</span>
<span class="nc" id="L813">    }</span>

    /**
     * Debug action to dump a tile to stderr.
     *
     * Called from tile popup menu.
     * Not concerned with i18n for stderr output.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @param tile The &lt;code&gt;Tile&lt;/code&gt; to dump.
     */
    public static void dumpTile(final FreeColClient freeColClient,
                                final Tile tile) {
<span class="nc" id="L826">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L827">        final Game sGame = server.getGame();</span>
<span class="nc" id="L828">        final Player player = freeColClient.getMyPlayer();</span>

<span class="nc" id="L830">        System.err.println(&quot;\nClient (&quot; + player.getId() + &quot;):&quot;);</span>
<span class="nc" id="L831">        tile.save(System.err, WriteScope.toClient(player), true);</span>
<span class="nc" id="L832">        System.err.println(&quot;\n\nServer:&quot;);</span>
<span class="nc" id="L833">        Tile sTile = sGame.getFreeColGameObject(tile.getId(), Tile.class);</span>
<span class="nc" id="L834">        sTile.save(System.err, WriteScope.toServer(), true);</span>
<span class="nc" id="L835">        System.err.println(&quot;\n\nSave:&quot;);</span>
<span class="nc" id="L836">        sTile.save(System.err, WriteScope.toSave(), true);</span>
<span class="nc" id="L837">        System.err.println(&quot;\n&quot;);</span>
<span class="nc" id="L838">    }</span>

    /**
     * Debug action to reset the moves left of the units on a tile.
     *
     * Called from tile popup menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @param units The &lt;code&gt;Unit&lt;/code&gt;s to reactivate.
     */
    public static void resetMoves(final FreeColClient freeColClient,
                                  List&lt;Unit&gt; units) {
<span class="nc" id="L850">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L851">        final Game sGame = server.getGame();</span>
<span class="nc" id="L852">        final GUI gui = freeColClient.getGUI();</span>

<span class="nc" id="L854">        boolean first = true;</span>
<span class="nc bnc" id="L855" title="All 2 branches missed.">        for (Unit u : units) {</span>
<span class="nc" id="L856">            Unit su = sGame.getFreeColGameObject(u.getId(), Unit.class);</span>
<span class="nc" id="L857">            u.setMovesLeft(u.getInitialMovesLeft());</span>
<span class="nc" id="L858">            su.setMovesLeft(su.getInitialMovesLeft());</span>
<span class="nc bnc" id="L859" title="All 2 branches missed.">            if (first) {</span>
<span class="nc" id="L860">                gui.setActiveUnit(u);</span>
<span class="nc" id="L861">                first = false;</span>
            }
<span class="nc bnc" id="L863" title="All 2 branches missed.">            for (Unit u2 : u.getUnitList()) {</span>
<span class="nc" id="L864">                Unit su2 = sGame.getFreeColGameObject(u2.getId(), Unit.class);</span>
<span class="nc" id="L865">                u2.setMovesLeft(u2.getInitialMovesLeft());</span>
<span class="nc" id="L866">                su2.setMovesLeft(su2.getInitialMovesLeft());</span>
            }
        }
<span class="nc" id="L869">        gui.refresh();</span>
<span class="nc" id="L870">        gui.resetMenuBar();</span>
<span class="nc" id="L871">    }</span>

    /**
     * Debug action to reveal or hide the map.
     *
     * Called from the debug menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @param reveal If true, reveal the map, else hide the map.
     */
    public static void revealMap(final FreeColClient freeColClient,
                                 boolean reveal) {
<span class="nc" id="L883">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L884">        final Game game = freeColClient.getGame();</span>

<span class="nc" id="L886">        server.exploreMapForAllPlayers(reveal);</span>

        // Removes fog of war when revealing the whole map
        // Restores previous setting when hiding it back again
<span class="nc" id="L890">        BooleanOption fogOfWarSetting = game.getSpecification()</span>
<span class="nc" id="L891">            .getBooleanOption(GameOptions.FOG_OF_WAR);</span>
<span class="nc bnc" id="L892" title="All 2 branches missed.">        if (reveal) {</span>
<span class="nc" id="L893">            FreeColDebugger.setNormalGameFogOfWar(fogOfWarSetting.getValue());</span>
<span class="nc" id="L894">            fogOfWarSetting.setValue(false);</span>
<span class="nc" id="L895">        } else {</span>
<span class="nc" id="L896">            fogOfWarSetting.setValue(FreeColDebugger.getNormalGameFogOfWar());</span>
        }
<span class="nc" id="L898">    }</span>

    /**
     * Debug action to set the amount of goods in a colony.
     *
     * Called from the colony panel.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @param colony The &lt;code&gt;Colony&lt;/code&gt; to set goods amounts in.
     */
    public static void setColonyGoods(final FreeColClient freeColClient,
                                      final Colony colony) {
<span class="nc" id="L910">        final Specification spec = colony.getSpecification();</span>
<span class="nc" id="L911">        GoodsType goodsType = freeColClient.getGUI().getChoice(null,</span>
<span class="nc" id="L912">            StringTemplate.template(&quot;prompt.selectGoodsType&quot;), &quot;cancel&quot;,</span>
<span class="nc" id="L913">            transformAndSort(spec.getGoodsTypeList(),</span>
<span class="nc bnc" id="L914" title="All 4 branches missed.">                gt -&gt; !gt.isFoodType() || gt == spec.getPrimaryFoodType(),</span>
<span class="nc" id="L915">                (GoodsType gt) -&gt;</span>
<span class="nc" id="L916">                    new ChoiceItem&lt;GoodsType&gt;(Messages.getName(gt), gt),</span>
<span class="nc" id="L917">                Collectors.toList()));</span>
<span class="nc bnc" id="L918" title="All 2 branches missed.">        if (goodsType == null) return;</span>

<span class="nc" id="L920">        String response = freeColClient.getGUI().getInput(null,</span>
<span class="nc" id="L921">                StringTemplate.template(&quot;prompt.selectGoodsAmount&quot;),</span>
<span class="nc" id="L922">                Integer.toString(colony.getGoodsCount(goodsType)),</span>
<span class="nc" id="L923">                &quot;ok&quot;, &quot;cancel&quot;);</span>
<span class="nc bnc" id="L924" title="All 4 branches missed.">        if (response == null || response.isEmpty()) return;</span>
        int a;
        try {
<span class="nc" id="L927">            a = Integer.parseInt(response);</span>
<span class="nc" id="L928">        } catch (NumberFormatException nfe) {</span>
<span class="nc" id="L929">            return;</span>
        }

<span class="nc" id="L932">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L933">        final Game sGame = server.getGame();</span>
<span class="nc" id="L934">        final Specification sSpec = server.getSpecification();</span>
<span class="nc" id="L935">        final GoodsType sGoodsType = sSpec.getGoodsType(goodsType.getId());</span>
<span class="nc" id="L936">        GoodsContainer cgc = colony.getGoodsContainer();</span>
<span class="nc" id="L937">        GoodsContainer sgc = sGame.getFreeColGameObject(cgc.getId(),</span>
<span class="nc" id="L938">                                                        GoodsContainer.class);</span>
<span class="nc" id="L939">        cgc.setAmount(goodsType, a);</span>
<span class="nc" id="L940">        sgc.setAmount(sGoodsType, a);</span>
<span class="nc" id="L941">    }</span>

    /**
     * Debug action to set the next monarch action.
     *
     * Called from the debug menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @param monarchTitle A label for the choice dialog.
     */
    public static void setMonarchAction(final FreeColClient freeColClient,
                                        String monarchTitle) {
<span class="nc" id="L953">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L954">        final Game sGame = server.getGame();</span>
<span class="nc" id="L955">        final Player player = freeColClient.getMyPlayer();</span>
<span class="nc" id="L956">        final ServerPlayer sPlayer = sGame.getFreeColGameObject(player.getId(),</span>
<span class="nc" id="L957">            ServerPlayer.class);</span>
<span class="nc" id="L958">        final GUI gui = freeColClient.getGUI();</span>

<span class="nc" id="L960">        MonarchAction action = gui.getChoice(null, monarchTitle,</span>
<span class="nc" id="L961">            &quot;cancel&quot;,</span>
<span class="nc" id="L962">            toSortedList(map(MonarchAction.values(), (MonarchAction a) -&gt;</span>
<span class="nc" id="L963">                    new ChoiceItem&lt;MonarchAction&gt;(a))));</span>
<span class="nc bnc" id="L964" title="All 2 branches missed.">        if (action == null) return;</span>
        
<span class="nc" id="L966">        server.getInGameController().setMonarchAction(sPlayer, action);</span>
<span class="nc" id="L967">    }</span>

    /**
     * Debug action to set the lost city rumour type on a tile.
     *
     * Called from tile popup menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @param tile The &lt;code&gt;Tile&lt;/code&gt; to operate on.
     */
    public static void setRumourType(final FreeColClient freeColClient,
                                     final Tile tile) {
<span class="nc" id="L979">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L980">        final Game sGame = server.getGame();</span>
<span class="nc" id="L981">        final Tile sTile = sGame.getFreeColGameObject(tile.getId(),</span>
<span class="nc" id="L982">                                                      Tile.class);</span>

<span class="nc" id="L984">        RumourType rumourChoice = freeColClient.getGUI().getChoice(null,</span>
<span class="nc" id="L985">            StringTemplate.template(&quot;prompt.selectLostCityRumour&quot;),</span>
<span class="nc" id="L986">            &quot;cancel&quot;,</span>
<span class="nc" id="L987">            transformAndSort(RumourType.values(), </span>
<span class="nc bnc" id="L988" title="All 2 branches missed.">                r -&gt; r != RumourType.NO_SUCH_RUMOUR,</span>
<span class="nc" id="L989">                (RumourType r) -&gt; new ChoiceItem&lt;RumourType&gt;(r.toString(), r),</span>
<span class="nc" id="L990">                Collectors.toList()));</span>
<span class="nc bnc" id="L991" title="All 2 branches missed.">        if (rumourChoice == null) return;</span>

<span class="nc" id="L993">        tile.getTileItemContainer().getLostCityRumour().setType(rumourChoice);</span>
<span class="nc" id="L994">        sTile.getTileItemContainer().getLostCityRumour()</span>
<span class="nc" id="L995">            .setType(rumourChoice);</span>
<span class="nc" id="L996">    }</span>

    /**
     * Debug action to skip turns.
     *
     * Called from the debug menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     */
    public static void skipTurns(FreeColClient freeColClient) {
<span class="nc" id="L1006">        freeColClient.skipTurns(0); // Clear existing skipping</span>

<span class="nc" id="L1008">        String response = freeColClient.getGUI().getInput(null,</span>
<span class="nc" id="L1009">            StringTemplate.key(&quot;prompt.selectTurnsToSkip&quot;),</span>
<span class="nc" id="L1010">            Integer.toString(10), &quot;ok&quot;, &quot;cancel&quot;);</span>
<span class="nc bnc" id="L1011" title="All 4 branches missed.">        if (response == null || response.isEmpty()) return;</span>
        int skip;
        try {
<span class="nc" id="L1014">            skip = Integer.parseInt(response);</span>
<span class="nc" id="L1015">        } catch (NumberFormatException nfe) {</span>
<span class="nc" id="L1016">            skip = -1;</span>
        }
<span class="nc bnc" id="L1018" title="All 2 branches missed.">        if (skip &gt; 0) freeColClient.skipTurns(skip);</span>
<span class="nc" id="L1019">    }</span>

    /**
     * Debug action to display statistics.
     *
     * Called from the debug menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     */
    public static void statistics(FreeColClient freeColClient) {
<span class="nc" id="L1029">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L1030">        final Game sGame = server.getGame();</span>
<span class="nc" id="L1031">        final Game cGame = freeColClient.getGame();</span>
<span class="nc" id="L1032">        final GUI gui = freeColClient.getGUI();</span>

<span class="nc" id="L1034">        java.util.Map&lt;String, String&gt; serverStats = sGame.getStatistics();</span>
<span class="nc" id="L1035">        serverStats.putAll(server.getAIMain().getAIStatistics());</span>
<span class="nc" id="L1036">        java.util.Map&lt;String, String&gt; clientStats = cGame.getStatistics();</span>
<span class="nc" id="L1037">        gui.showStatisticsPanel(serverStats, clientStats);</span>
<span class="nc" id="L1038">    }</span>

    /**
     * Debug action to step the random number generator.
     *
     * Called from the debug menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     */
    public static void stepRNG(FreeColClient freeColClient) {
<span class="nc" id="L1048">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L1049">        final GUI gui = freeColClient.getGUI();</span>

<span class="nc" id="L1051">        boolean more = true;</span>
<span class="nc bnc" id="L1052" title="All 2 branches missed.">        while (more) {</span>
<span class="nc" id="L1053">            int val = server.getInGameController().stepRandom();</span>
<span class="nc" id="L1054">            more = gui.confirm(null, StringTemplate</span>
<span class="nc" id="L1055">                .template(&quot;prompt.stepRNG&quot;)</span>
<span class="nc" id="L1056">                .addAmount(&quot;%value%&quot;, val),</span>
<span class="nc" id="L1057">                &quot;more&quot;, &quot;cancel&quot;);</span>
        }
<span class="nc" id="L1059">    }</span>

    /**
     * Debug action to summarize information about a native settlement
     * that is normally hidden.
     *
     * Called from tile popup menu.
     * TODO: missing i18n
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     * @param is The &lt;code&gt;IndianSettlement&lt;/code&gt; to summarize.
     */
    public static void summarizeSettlement(final FreeColClient freeColClient,
                                           final IndianSettlement is) {
<span class="nc" id="L1073">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L1074">        final Game sGame = server.getGame();</span>
<span class="nc" id="L1075">        final AIMain aiMain = server.getAIMain();</span>
<span class="nc" id="L1076">        final Specification sSpec = sGame.getSpecification();</span>
<span class="nc" id="L1077">        final IndianSettlement sis = sGame.getFreeColGameObject(is.getId(),</span>
<span class="nc" id="L1078">            IndianSettlement.class);</span>
<span class="nc" id="L1079">        final List&lt;GoodsType&gt; sGoodsTypes = sSpec.getGoodsTypeList();</span>

<span class="nc" id="L1081">        LogBuilder lb = new LogBuilder(256);</span>
<span class="nc" id="L1082">        lb.add(sis.getName(), &quot;\n\nAlarm\n&quot;);</span>
<span class="nc" id="L1083">        Player mostHated = sis.getMostHated();</span>
<span class="nc bnc" id="L1084" title="All 2 branches missed.">        for (Player p : sGame.getLiveEuropeanPlayers(null)) {</span>
<span class="nc" id="L1085">            Tension tension = sis.getAlarm(p);</span>
<span class="nc" id="L1086">            lb.add(Messages.message(p.getNationLabel()),</span>
<span class="nc bnc" id="L1087" title="All 2 branches missed.">                   &quot; &quot;, ((tension == null) ? &quot;(none)&quot;</span>
<span class="nc" id="L1088">                       : Integer.toString(tension.getValue())),</span>
<span class="nc bnc" id="L1089" title="All 2 branches missed.">                   ((mostHated == p) ? &quot; (most hated)&quot; : &quot;&quot;),</span>
<span class="nc" id="L1090">                   &quot; &quot;, Messages.message(sis.getAlarmLevelKey(p)),</span>
<span class="nc" id="L1091">                   &quot; &quot;, sis.getContactLevel(p), &quot;\n&quot;);</span>
        }

<span class="nc" id="L1094">        lb.add(&quot;\nGoods\n&quot;);</span>
<span class="nc bnc" id="L1095" title="All 2 branches missed.">        for (GoodsType gt : sGoodsTypes) {</span>
<span class="nc" id="L1096">            int amount = sis.getGoodsCount(gt);</span>
<span class="nc" id="L1097">            int prod = sis.getTotalProductionOf(gt);</span>
<span class="nc bnc" id="L1098" title="All 4 branches missed.">            if (amount &gt; 0 || prod != 0) {</span>
<span class="nc" id="L1099">                lb.add(Messages.message(AbstractGoods.getLabel(gt, amount)),</span>
<span class="nc bnc" id="L1100" title="All 2 branches missed.">                    &quot; &quot;, ((prod &gt; 0) ? &quot;+&quot; : &quot;&quot;), prod, &quot;\n&quot;);</span>
            }
        }

<span class="nc" id="L1104">        lb.add(&quot;\nPotential sales\n&quot;);</span>
<span class="nc bnc" id="L1105" title="All 2 branches missed.">        for (Goods g : sis.getSellGoods(sGoodsTypes.size(), null)) {</span>
<span class="nc" id="L1106">            lb.add(Messages.getName(g.getType()), &quot; &quot;, g.getAmount(),</span>
<span class="nc" id="L1107">                &quot; = &quot;, sis.getPriceToSell(g.getType(), g.getAmount()), &quot;\n&quot;);</span>
        }
        
<span class="nc" id="L1110">        lb.add(&quot;\nPrices (buy 1/100 / sell 1/100)\n&quot;);</span>
<span class="nc" id="L1111">        GoodsType[] wanted = sis.getWantedGoods();</span>
<span class="nc bnc" id="L1112" title="All 2 branches missed.">        for (GoodsType type : sSpec.getStorableGoodsTypeList()) {</span>
            int i;
<span class="nc bnc" id="L1114" title="All 2 branches missed.">            for (i = wanted.length - 1; i &gt;= 0; i--) {</span>
<span class="nc bnc" id="L1115" title="All 2 branches missed.">                if (type == wanted[i]) break;</span>
            }
<span class="nc" id="L1117">            lb.add(Messages.getName(type),</span>
<span class="nc" id="L1118">                   &quot;: &quot;, sis.getPriceToBuy(type, 1),</span>
<span class="nc" id="L1119">                   &quot;/&quot;, sis.getPriceToBuy(type, 100),</span>
<span class="nc" id="L1120">                   &quot; / &quot;, sis.getPriceToSell(type, 1),</span>
<span class="nc" id="L1121">                   &quot;/&quot;, sis.getPriceToSell(type, 100),</span>
<span class="nc bnc" id="L1122" title="All 2 branches missed.">                   ((i &lt; 0) ? &quot;&quot; : &quot; wanted[&quot; + Integer.toString(i) + &quot;]&quot;),</span>
<span class="nc" id="L1123">                   &quot;\n&quot;);</span>
        }

<span class="nc" id="L1126">        lb.add(&quot;\nUnits present\n&quot;);</span>
<span class="nc bnc" id="L1127" title="All 2 branches missed.">        for (Unit u : sis.getUnitList()) {</span>
<span class="nc" id="L1128">            Mission m = aiMain.getAIUnit(u).getMission();</span>
<span class="nc" id="L1129">            lb.add(u, &quot; at &quot;, u.getLocation());</span>
<span class="nc bnc" id="L1130" title="All 2 branches missed.">            if (m != null) {</span>
<span class="nc" id="L1131">                lb.add(&quot; &quot;, m.getClass(), &quot;.&quot;);</span>
            }
<span class="nc" id="L1133">            lb.add(&quot;\n&quot;);</span>
        }
<span class="nc" id="L1135">        lb.add(&quot;\nUnits owned\n&quot;);</span>
<span class="nc bnc" id="L1136" title="All 2 branches missed.">        for (Unit u : sis.getOwnedUnits()) {</span>
<span class="nc" id="L1137">            Mission m = aiMain.getAIUnit(u).getMission();</span>
<span class="nc" id="L1138">            lb.add(u, &quot; at &quot;, u.getLocation());</span>
<span class="nc bnc" id="L1139" title="All 2 branches missed.">            if (m != null) {</span>
<span class="nc" id="L1140">                lb.add(&quot; &quot;, m.getClass(), &quot;.&quot;);</span>
            }
<span class="nc" id="L1142">            lb.add(&quot;\n&quot;);</span>
        }

<span class="nc" id="L1145">        lb.add(&quot;\nTiles\n&quot;);</span>
<span class="nc bnc" id="L1146" title="All 2 branches missed.">        for (Tile t : sis.getOwnedTiles()) lb.add(t, &quot;\n&quot;);</span>

<span class="nc" id="L1148">        lb.add(&quot;\nConvert Progress = &quot;, sis.getConvertProgress());</span>
<span class="nc" id="L1149">        lb.add(&quot;\nLast Tribute = &quot;, sis.getLastTribute());</span>

<span class="nc" id="L1151">        freeColClient.getGUI().showInformationMessage(lb.toString());</span>
<span class="nc" id="L1152">    }</span>

    /**
     * Debug action to run the AI.
     *
     * Called from the debug menu.
     *
     * @param freeColClient The &lt;code&gt;FreeColClient&lt;/code&gt; for the game.
     */
    public static void useAI(final FreeColClient freeColClient) {
<span class="nc" id="L1162">        final FreeColServer server = freeColClient.getFreeColServer();</span>
<span class="nc" id="L1163">        final Player player = freeColClient.getMyPlayer();</span>
<span class="nc" id="L1164">        final AIMain aiMain = server.getAIMain();</span>
<span class="nc" id="L1165">        final AIPlayer ap = aiMain.getAIPlayer(player);</span>

<span class="nc" id="L1167">        ap.setDebuggingConnection(freeColClient.askServer().getConnection());</span>
<span class="nc" id="L1168">        ap.startWorking();</span>
<span class="nc" id="L1169">        freeColClient.getConnectController().reconnect();</span>
<span class="nc" id="L1170">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span>net.sf.freecol.tools (2) (May 15, 2016 11:18:55 PM)</div></body></html>